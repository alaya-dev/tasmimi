import{r as C,c as _,o as k,b as r,d as B,n as S,u as f,a as x,w,e as b,t as h,B as q,_ as F,p as ie,z as le,g as de,Z as ce,F as pe,f as ue,i as me,q as ge,s as he}from"./app-BJSEvLr2.js";import{A as fe}from"./ApplicationLogo-Blzbi56v.js";import{_ as G,a as be}from"./DropdownLink-BKuK1C9h.js";import{_ as D,a as T}from"./ResponsiveNavLink-uBXcu5k_.js";import{u as ye}from"./useTranslations-CytgtFYN.js";/* empty css                   */import{_ as ve}from"./_plugin-vue_export-helper-DlAUqK2U.js";const xe=["dir"],we={class:"bg-white shadow"},ke={class:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8"},Ce={class:"flex items-center"},_e={class:"flex-shrink-0 flex items-center"},Ee={class:"hidden sm:flex sm:items-center"},Me={class:"inline-flex rounded-md"},Ae={type:"button",class:"inline-flex items-center px-3 py-2 border border-transparent text-sm leading-4 font-medium rounded-md text-gray-500 bg-white hover:text-gray-700 focus:outline-none transition ease-in-out duration-150"},Se={class:"h-6 w-6",stroke:"currentColor",fill:"none",viewBox:"0 0 24 24"},ze={class:"pt-2 pb-3 space-y-1"},Ie={class:"pt-4 pb-1 border-t border-gray-200"},je={class:"px-4"},$e={class:"font-medium text-base text-gray-800"},Te={class:"font-medium text-sm text-gray-500"},Ne={class:"mt-3 space-y-1"},Le={key:0,class:"bg-white shadow"},We={class:"max-w-7xl mx-auto py-6 px-4 sm:px-6 lg:px-8"},Be={__name:"AdminLayout",setup(z){const a=C(!1),{__:o,isRTL:e,direction:t}=ye();return(n,i)=>(k(),_("div",{dir:f(t),class:"min-h-screen bg-gray-100"},[r("nav",we,[r("div",ke,[r("div",{class:S([f(e)?"flex-row-reverse":"flex","flex justify-between h-16"])},[r("div",Ce,[r("div",_e,[x(fe,{class:"block h-9 w-auto fill-current text-gray-800"}),r("span",{class:S([f(e)?"mr-2":"ml-2","text-xl font-semibold text-gray-800"])}," Admin",2)]),r("div",{class:S([f(e)?"space-x-reverse sm:mr-10":"space-x-8 sm:ml-10","hidden sm:-my-px sm:flex"])},[x(D,{href:n.route("admin.dashboard"),active:n.route().current("admin.dashboard")},{default:w(()=>[b(h(f(o)("common.dashboard")),1)]),_:1},8,["href","active"]),x(D,{href:n.route("admin.users.index"),active:n.route().current("admin.users.*")},{default:w(()=>[b(h(f(o)("common.users")),1)]),_:1},8,["href","active"]),x(D,{href:n.route("admin.contacts.index"),active:n.route().current("admin.contacts.*")},{default:w(()=>[b(h(f(o)("common.contacts")),1)]),_:1},8,["href","active"]),x(D,{href:n.route("admin.client-subscriptions.index"),active:n.route().current("admin.client-subscriptions.*")},{default:w(()=>i[1]||(i[1]=[b(" اشتراكات العملاء ")])),_:1,__:[1]},8,["href","active"])],2)]),r("div",Ee,[r("div",{class:S([f(e)?"me-3":"ml-3","relative"])},[x(be,{align:f(e)?"left":"right",width:"48"},{trigger:w(()=>[r("span",Me,[r("button",Ae,[b(h(n.$page.props.auth.user.email)+" ",1),(k(),_("svg",{class:S([f(e)?"me-2 -ms-0.5":"ml-2 -mr-0.5","h-4 w-4"]),xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor"},i[2]||(i[2]=[r("path",{"fill-rule":"evenodd",d:"M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z","clip-rule":"evenodd"},null,-1)]),2))])])]),content:w(()=>[x(G,{href:n.route("profile.edit")},{default:w(()=>[b(h(f(o)("common.profile")),1)]),_:1},8,["href"]),x(G,{href:n.route("logout"),method:"post",as:"button"},{default:w(()=>[b(h(f(o)("auth.logout")),1)]),_:1},8,["href"])]),_:1},8,["align"])],2)]),r("div",{class:S([f(e)?"-ml-2":"-mr-2","flex items-center sm:hidden"])},[r("button",{onClick:i[0]||(i[0]=c=>a.value=!a.value),class:"inline-flex items-center justify-center p-2 rounded-md text-gray-400 hover:text-gray-500 hover:bg-gray-100 focus:outline-none focus:bg-gray-100 focus:text-gray-500 transition duration-150 ease-in-out"},[(k(),_("svg",Se,[r("path",{class:S({hidden:a.value,"inline-flex":!a.value}),"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h16"},null,2),r("path",{class:S({hidden:!a.value,"inline-flex":a.value}),"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"},null,2)]))])],2)],2)]),r("div",{class:S([{block:a.value,hidden:!a.value},"sm:hidden"])},[r("div",ze,[x(T,{href:n.route("admin.dashboard"),active:n.route().current("admin.dashboard")},{default:w(()=>[b(h(f(o)("common.dashboard")),1)]),_:1},8,["href","active"]),x(T,{href:n.route("admin.users.index"),active:n.route().current("admin.users.*")},{default:w(()=>[b(h(f(o)("common.users")),1)]),_:1},8,["href","active"]),x(T,{href:n.route("admin.contacts.index"),active:n.route().current("admin.contacts.*")},{default:w(()=>[b(h(f(o)("common.contacts")),1)]),_:1},8,["href","active"]),x(T,{href:n.route("admin.client-subscriptions.index"),active:n.route().current("admin.client-subscriptions.*")},{default:w(()=>i[3]||(i[3]=[b(" اشتراكات العملاء ")])),_:1,__:[3]},8,["href","active"])]),r("div",Ie,[r("div",je,[r("div",$e,h(n.$page.props.auth.user.email),1),r("div",Te,h(n.$page.props.auth.user.email),1)]),r("div",Ne,[x(T,{href:n.route("profile.edit")},{default:w(()=>[b(h(f(o)("common.profile")),1)]),_:1},8,["href"]),x(T,{href:n.route("logout"),method:"post",as:"button"},{default:w(()=>[b(h(f(o)("auth.logout")),1)]),_:1},8,["href"])])])],2)]),n.$slots.header?(k(),_("header",Le,[r("div",We,[q(n.$slots,"header")])])):B("",!0),r("main",null,[q(n.$slots,"default")])],8,xe))}},De={"arabic-text":{label:"نص عربي",category:"النصوص",content:{type:"text",content:"أدخل النص هنا",style:{"font-family":"Cairo, Arial, sans-serif","font-size":"16px",color:"#333333",padding:"10px",direction:"rtl","text-align":"right"},attributes:{"data-editable":"true","data-element-type":"text","data-field-name":"نص"}}},"arabic-heading":{label:"عنوان عربي",category:"النصوص",content:{tagName:"h1",type:"text",content:"عنوان رئيسي",style:{"font-family":"Cairo, Arial, sans-serif","font-size":"32px","font-weight":"bold",color:"#1e293b",margin:"10px 0",direction:"rtl","text-align":"center"},attributes:{"data-editable":"true","data-element-type":"heading","data-field-name":"عنوان"}}},"name-field":{label:"حقل الاسم",category:"الحقول",content:{type:"text",content:"الاسم: _______________",style:{"font-family":"Cairo, Arial, sans-serif","font-size":"18px",color:"#374151",padding:"8px",direction:"rtl","text-align":"right","border-bottom":"2px dotted #d1d5db"},attributes:{"data-editable":"true","data-element-type":"name-field","data-field-name":"الاسم"}}},"date-field":{label:"حقل التاريخ",category:"الحقول",content:{type:"text",content:"التاريخ: __ / __ / ____",style:{"font-family":"Cairo, Arial, sans-serif","font-size":"16px",color:"#374151",padding:"8px",direction:"rtl","text-align":"right"},attributes:{"data-editable":"true","data-element-type":"date-field","data-field-name":"التاريخ"}}},"occasion-field":{label:"حقل المناسبة",category:"الحقول",content:{type:"text",content:"المناسبة: _______________",style:{"font-family":"Cairo, Arial, sans-serif","font-size":"18px",color:"#374151",padding:"8px",direction:"rtl","text-align":"right","border-bottom":"2px dotted #d1d5db"},attributes:{"data-editable":"true","data-element-type":"occasion-field","data-field-name":"المناسبة"}}},"logo-placeholder":{label:"شعار/لوجو",category:"الوسائط",content:{type:"image",style:{width:"100px",height:"100px","object-fit":"contain",border:"2px dashed #d1d5db","border-radius":"8px"},attributes:{"data-element-type":"logo","data-field-name":"الشعار",src:"data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTAwIiBoZWlnaHQ9IjEwMCIgdmlld0JveD0iMCAwIDEwMCAxMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMDAiIGhlaWdodD0iMTAwIiBmaWxsPSIjRjNGNEY2Ii8+CjxwYXRoIGQ9Ik0zNSA2NUw1MCA0NUw2NSA2NUgzNVoiIGZpbGw9IiM5Q0EzQUYiLz4KPHN2ZyB3aWR0aD0iMjQiIGhlaWdodD0iMjQiIHZpZXdCb3g9IjAgMCAyNCAyNCIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHBhdGggZD0iTTQgMTZMNC41ODYgMTUuNDE0QTIgMiAwIDAgMSA3LjQxNCAxNS40MTRMOCA2TTE2IDE2TDE1LjQxNCAxNS40MTRBMSA0IDAgMCAwIDEyLjU4NiAxNS40MTRMOCA2TTggNkg4LjAxTTYgMjBIMThBMiAyIDAgMCAwIDIwIDE4VjZBMiAyIDAgMCAwIDE4IDRINkEyIDIgMCAwIDAgNCA2VjE4QTIgMiAwIDAgMCA2IDIwWiIgc3Ryb2tlPSIjOUNBM0FGIiBzdHJva2Utd2lkdGg9IjIiIHN0cm9rZS1saW5lY2FwPSJyb3VuZCIgc3Ryb2tlLWxpbmVqb2luPSJyb3VuZCIvPgo8L3N2Zz4K"}}},"decorative-image":{label:"صورة زخرفية",category:"الوسائط",content:{type:"image",style:{width:"150px",height:"100px","object-fit":"cover","border-radius":"8px"},attributes:{"data-element-type":"decorative-image","data-field-name":"صورة زخرفية",src:"https://via.placeholder.com/150x100/e2e8f0/64748b?text=صورة"}}},"arabic-button":{label:"زر عربي",category:"التفاعل",content:{tagName:"button",type:"text",content:"انقر هنا",style:{background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white",padding:"12px 24px",border:"none","border-radius":"8px","font-family":"Cairo, Arial, sans-serif","font-size":"16px","font-weight":"600",cursor:"pointer",direction:"rtl","box-shadow":"0 4px 6px rgba(59, 130, 246, 0.3)"},attributes:{"data-editable":"true","data-element-type":"button","data-field-name":"زر"}}},"decorative-line":{label:"خط زخرفي",category:"الأشكال",content:{tagName:"div",style:{width:"200px",height:"2px",background:"linear-gradient(90deg, transparent 0%, #d1d5db 50%, transparent 100%)",margin:"20px auto"},attributes:{"data-element-type":"decorative-line","data-field-name":"خط زخرفي"}}},"decorative-border":{label:"إطار زخرفي",category:"الأشكال",content:{tagName:"div",content:'<div style="padding: 20px; text-align: center; color: #6b7280;">محتوى الإطار</div>',style:{border:"3px solid #e5e7eb","border-radius":"12px",background:"rgba(249, 250, 251, 0.5)",margin:"10px","min-height":"100px",position:"relative"},attributes:{"data-element-type":"decorative-border","data-field-name":"إطار زخرفي"}}},"islamic-pattern":{label:"زخرفة إسلامية",category:"الزخارف",content:{tagName:"div",style:{width:"80px",height:"80px",background:`url("data:image/svg+xml,%3Csvg width='60' height='60' viewBox='0 0 60 60' xmlns='http://www.w3.org/2000/svg'%3E%3Cg fill='none' fill-rule='evenodd'%3E%3Cg fill='%23d1d5db' fill-opacity='0.4'%3E%3Cpath d='M30 30c0-16.569 13.431-30 30-30v60c-16.569 0-30-13.431-30-30z'/%3E%3C/g%3E%3C/g%3E%3C/svg%3E")`,"background-size":"contain","background-repeat":"no-repeat","background-position":"center",margin:"10px auto"},attributes:{"data-element-type":"islamic-pattern","data-field-name":"زخرفة إسلامية"}}},watermark:{label:"ختم الحقوق",category:"الحماية",content:{type:"text",content:"سامقة © جميع الحقوق محفوظة",style:{position:"absolute",bottom:"10px",right:"10px","font-family":"Cairo, Arial, sans-serif","font-size":"10px",color:"rgba(107, 114, 128, 0.6)",background:"rgba(255, 255, 255, 0.8)",padding:"4px 8px","border-radius":"4px","pointer-events":"none","user-select":"none","z-index":"1000"},attributes:{"data-element-type":"watermark","data-field-name":"ختم الحقوق","data-locked":"true"}}}},Re=z=>{const a=z.BlockManager;return a.getAll().reset(),Object.entries(De).forEach(([o,e])=>{a.add(o,e)}),a},He={sectors:[{name:"التخطيط العام",open:!0,properties:[{name:"العرض",property:"width",type:"integer",units:["px","%","em","rem"],defaults:"auto"},{name:"الارتفاع",property:"height",type:"integer",units:["px","%","em","rem"],defaults:"auto"},{name:"العرض الأقصى",property:"max-width",type:"integer",units:["px","%","em","rem"]},{name:"الارتفاع الأقصى",property:"max-height",type:"integer",units:["px","%","em","rem"]},{name:"نوع العرض",property:"display",type:"select",defaults:"block",options:[{value:"block",name:"كتلة"},{value:"inline",name:"سطري"},{value:"inline-block",name:"سطري-كتلة"},{value:"flex",name:"مرن"},{value:"grid",name:"شبكة"},{value:"none",name:"مخفي"}]},{name:"الموضع",property:"position",type:"select",defaults:"static",options:[{value:"static",name:"ثابت"},{value:"relative",name:"نسبي"},{value:"absolute",name:"مطلق"},{value:"fixed",name:"مثبت"},{value:"sticky",name:"لاصق"}]}]},{name:"المسافات والحدود",open:!1,properties:[{name:"الهامش الخارجي",property:"margin",type:"composite",properties:[{name:"أعلى",property:"margin-top",type:"integer",units:["px","em","%"]},{name:"يمين",property:"margin-right",type:"integer",units:["px","em","%"]},{name:"أسفل",property:"margin-bottom",type:"integer",units:["px","em","%"]},{name:"يسار",property:"margin-left",type:"integer",units:["px","em","%"]}]},{name:"الهامش الداخلي",property:"padding",type:"composite",properties:[{name:"أعلى",property:"padding-top",type:"integer",units:["px","em","%"]},{name:"يمين",property:"padding-right",type:"integer",units:["px","em","%"]},{name:"أسفل",property:"padding-bottom",type:"integer",units:["px","em","%"]},{name:"يسار",property:"padding-left",type:"integer",units:["px","em","%"]}]},{name:"الحدود",property:"border",type:"composite",properties:[{name:"العرض",property:"border-width",type:"integer",units:["px"]},{name:"النوع",property:"border-style",type:"select",options:[{value:"none",name:"بدون"},{value:"solid",name:"صلب"},{value:"dashed",name:"متقطع"},{value:"dotted",name:"منقط"},{value:"double",name:"مزدوج"}]},{name:"اللون",property:"border-color",type:"color"}]},{name:"استدارة الزوايا",property:"border-radius",type:"integer",units:["px","%"],defaults:"0"}]},{name:"النصوص والخطوط",open:!1,properties:[{name:"نوع الخط",property:"font-family",type:"select",defaults:"Cairo, Arial, sans-serif",options:[{value:"Cairo, Arial, sans-serif",name:"Cairo (موصى به)"},{value:"Amiri, serif",name:"Amiri (تقليدي)"},{value:"Noto Sans Arabic, sans-serif",name:"Noto Sans Arabic"},{value:"Tajawal, sans-serif",name:"Tajawal"},{value:"Almarai, sans-serif",name:"Almarai"},{value:"Changa, sans-serif",name:"Changa"}]},{name:"حجم الخط",property:"font-size",type:"integer",units:["px","em","rem","%"],defaults:"16px"},{name:"وزن الخط",property:"font-weight",type:"select",defaults:"normal",options:[{value:"300",name:"خفيف"},{value:"400",name:"عادي"},{value:"600",name:"متوسط"},{value:"700",name:"عريض"},{value:"900",name:"عريض جداً"}]},{name:"لون النص",property:"color",type:"color",defaults:"#333333"},{name:"محاذاة النص",property:"text-align",type:"radio",defaults:"right",options:[{value:"right",name:"يمين",className:"fa fa-align-right"},{value:"center",name:"وسط",className:"fa fa-align-center"},{value:"left",name:"يسار",className:"fa fa-align-left"},{value:"justify",name:"ضبط",className:"fa fa-align-justify"}]},{name:"ارتفاع السطر",property:"line-height",type:"integer",units:["","px","em"],defaults:"1.5"},{name:"تباعد الأحرف",property:"letter-spacing",type:"integer",units:["px","em"],defaults:"0"},{name:"اتجاه النص",property:"direction",type:"radio",defaults:"rtl",options:[{value:"rtl",name:"يمين لليسار"},{value:"ltr",name:"يسار لليمين"}]}]},{name:"الخلفية والألوان",open:!1,properties:[{name:"لون الخلفية",property:"background-color",type:"color",defaults:"transparent"},{name:"صورة الخلفية",property:"background-image",type:"file",functionName:"url"},{name:"حجم الخلفية",property:"background-size",type:"select",defaults:"auto",options:[{value:"auto",name:"تلقائي"},{value:"cover",name:"تغطية"},{value:"contain",name:"احتواء"},{value:"100% 100%",name:"تمدد"}]},{name:"موضع الخلفية",property:"background-position",type:"select",defaults:"center center",options:[{value:"top left",name:"أعلى يسار"},{value:"top center",name:"أعلى وسط"},{value:"top right",name:"أعلى يمين"},{value:"center left",name:"وسط يسار"},{value:"center center",name:"وسط"},{value:"center right",name:"وسط يمين"},{value:"bottom left",name:"أسفل يسار"},{value:"bottom center",name:"أسفل وسط"},{value:"bottom right",name:"أسفل يمين"}]},{name:"تكرار الخلفية",property:"background-repeat",type:"select",defaults:"no-repeat",options:[{value:"no-repeat",name:"بدون تكرار"},{value:"repeat",name:"تكرار"},{value:"repeat-x",name:"تكرار أفقي"},{value:"repeat-y",name:"تكرار عمودي"}]}]},{name:"التأثيرات والظلال",open:!1,properties:[{name:"الشفافية",property:"opacity",type:"slider",defaults:"1",min:0,max:1,step:.1},{name:"ظل الصندوق",property:"box-shadow",type:"stack",preview:!0,properties:[{name:"الإزاحة الأفقية",property:"box-shadow-h",type:"integer",units:["px"]},{name:"الإزاحة العمودية",property:"box-shadow-v",type:"integer",units:["px"]},{name:"التمويه",property:"box-shadow-blur",type:"integer",units:["px"]},{name:"الانتشار",property:"box-shadow-spread",type:"integer",units:["px"]},{name:"اللون",property:"box-shadow-color",type:"color"},{name:"النوع",property:"box-shadow-type",type:"select",options:[{value:"",name:"خارجي"},{value:"inset",name:"داخلي"}]}]},{name:"التحويل",property:"transform",type:"composite",properties:[{name:"تدوير",property:"transform-rotate",type:"integer",units:["deg"]},{name:"تكبير X",property:"transform-scale-x",type:"number",step:.1},{name:"تكبير Y",property:"transform-scale-y",type:"number",step:.1},{name:"إزاحة X",property:"transform-translate-x",type:"integer",units:["px","%"]},{name:"إزاحة Y",property:"transform-translate-y",type:"integer",units:["px","%"]}]}]}]};class Pe{constructor(){this.version="1.0",this.watermarkText="سامقة © جميع الحقوق محفوظة"}processDesignData(a,o={}){try{const e=a.getHtml(),t=a.getCss(),n=a.getComponents(),i=a.getStyle(),c=a.getProjectData(),d=this.extractEditableElements(n),l=this.extractAssets(a),g=this.generateDesignStructure(n);return{version:this.version,timestamp:new Date().toISOString(),metadata:{canvasWidth:o.canvasWidth||800,canvasHeight:o.canvasHeight||600,category:o.category||null,templateName:o.templateName||null,createdBy:o.createdBy||null,...o},design:{html:e,css:t,projectData:c,structure:g},editableElements:d,assets:l,settings:{hasWatermark:this.hasWatermark(e),isRTL:this.isRTLDesign(t),fontFamilies:this.extractFontFamilies(t),colorPalette:this.extractColorPalette(t)}}}catch(e){throw console.error("Error processing design data:",e),new Error("فشل في معالجة بيانات التصميم")}}extractEditableElements(a){const o=[],e=t=>{const n=t.get("attributes")||{};if(n["data-editable"]==="true"){const c={id:t.getId(),type:n["data-element-type"]||"text",fieldName:n["data-field-name"]||"حقل",content:t.get("content")||"",styles:t.getStyle(),position:this.getElementPosition(t),constraints:{minLength:n["data-min-length"]?parseInt(n["data-min-length"]):null,maxLength:n["data-max-length"]?parseInt(n["data-max-length"]):null,required:n["data-required"]==="true",pattern:n["data-pattern"]||null},defaultValue:n["data-default-value"]||"",placeholder:n["data-placeholder"]||"",isLocked:n["data-locked"]==="true"};o.push(c)}const i=t.components();i&&i.length>0&&i.forEach(c=>e(c))};return a.forEach(t=>e(t)),o}getElementPosition(a){var n;const o=a.getEl();if(!o)return{x:0,y:0,width:0,height:0};const e=o.getBoundingClientRect(),t=((n=o.parentElement)==null?void 0:n.getBoundingClientRect())||{left:0,top:0};return{x:e.left-t.left,y:e.top-t.top,width:e.width,height:e.height,zIndex:a.getStyle("z-index")||"auto"}}extractAssets(a){return{images:a.AssetManager.getAll().filter(t=>t.get("type")==="image").map(t=>({id:t.get("id"),src:t.get("src"),name:t.get("name")||"",type:t.get("type"),size:t.get("size")||null})),fonts:this.extractFontFamilies(a.getCss()),colors:this.extractColorPalette(a.getCss())}}generateDesignStructure(a){const o={layers:[],groups:{},hierarchy:[]},e=(t,n=0)=>{const i={id:t.getId(),type:t.get("type"),tagName:t.get("tagName"),level:n,attributes:t.get("attributes")||{},styles:t.getStyle(),content:t.get("content")||"",children:[]},c=t.components();return c&&c.length>0&&c.forEach(d=>{const l=e(d,n+1);i.children.push(l.id),o.layers.push(l)}),o.layers.push(i),i};return a.forEach(t=>{const n=e(t);o.hierarchy.push(n.id)}),o}hasWatermark(a){return a.includes(this.watermarkText)||a.includes('data-element-type="watermark"')}isRTLDesign(a){return a.includes("direction: rtl")||a.includes("direction:rtl")}extractFontFamilies(a){const o=/font-family:\s*([^;]+)/gi,e=new Set;let t;for(;(t=o.exec(a))!==null;){const n=t[1].trim().replace(/['"]/g,"");e.add(n)}return Array.from(e)}extractColorPalette(a){const o=/(#[0-9a-fA-F]{3,6}|rgb\([^)]+\)|rgba\([^)]+\)|hsl\([^)]+\)|hsla\([^)]+\))/gi,e=new Set;let t;for(;(t=o.exec(a))!==null;)e.add(t[1]);return Array.from(e)}loadDesignData(a,o){try{if(!o||typeof o!="object")throw new Error("بيانات التصميم غير صحيحة");return o.version&&!this.isVersionCompatible(o.version)&&console.warn("Design data version mismatch:",o.version),a.setComponents(""),a.setStyle(""),o.design&&o.design.projectData?a.loadProjectData(o.design.projectData):o.design&&(o.design.html&&a.setComponents(o.design.html),o.design.css&&a.setStyle(o.design.css)),o.editableElements&&this.restoreEditableElements(a,o.editableElements),o.assets&&this.loadAssets(a,o.assets),!0}catch(e){throw console.error("Error loading design data:",e),new Error("فشل في تحميل بيانات التصميم")}}isVersionCompatible(a){const o=parseInt(this.version.split(".")[0]),e=parseInt(a.split(".")[0]);return o===e}restoreEditableElements(a,o){o.forEach(e=>{const t=a.getComponents().find(n=>n.getId()===e.id);t&&(t.setAttributes({...t.get("attributes"),"data-editable":"true","data-element-type":e.type,"data-field-name":e.fieldName,"data-required":e.constraints.required?"true":"false","data-locked":e.isLocked?"true":"false"}),e.styles&&t.setStyle(e.styles))})}loadAssets(a,o){const e=a.AssetManager;o.images&&o.images.forEach(t=>{e.add(t)})}validateDesignData(a){const o=[],e=[];return a?(a.design||o.push("بيانات التصميم الأساسية مفقودة"),a.version?this.isVersionCompatible(a.version)||e.push(`إصدار غير متوافق: ${a.version}`):e.push("رقم الإصدار مفقود"),a.editableElements&&!Array.isArray(a.editableElements)&&o.push("بيانات العناصر القابلة للتحرير غير صحيحة"),{isValid:o.length===0,errors:o,warnings:e}):(o.push("بيانات التصميم مفقودة"),{isValid:!1,errors:o,warnings:e})}}const R=new Pe;class Fe{constructor(){this.defaultOptions={width:400,height:300,quality:.8,format:"png",scale:.5,backgroundColor:"#ffffff"}}async generateFromEditor(a,o={}){try{const e={...this.defaultOptions,...o},t=a.Canvas.getElement();if(!t)throw new Error("Canvas element not found");const{toPng:n,toJpeg:i}=await F(async()=>{const{toPng:l,toJpeg:g}=await import("./index-CyNOPa0n.js");return{toPng:l,toJpeg:g}},[]);return await(e.format==="jpeg"?i:n)(t,{quality:e.quality,width:e.width,height:e.height,backgroundColor:e.backgroundColor,style:{transform:`scale(${e.scale})`,transformOrigin:"top left",width:`${e.width/e.scale}px`,height:`${e.height/e.scale}px`},filter:l=>!(l.classList&&(l.classList.contains("gjs-toolbar")||l.classList.contains("gjs-resizer")||l.classList.contains("gjs-badge")||l.classList.contains("gjs-highlighter")))})}catch(e){throw console.error("Error generating thumbnail from editor:",e),new Error("فشل في إنشاء المعاينة من المحرر")}}async generateFromHTML(a,o,e={}){try{const t={...this.defaultOptions,...e},n=document.createElement("div");n.style.position="absolute",n.style.top="-9999px",n.style.left="-9999px",n.style.width=`${t.width/t.scale}px`,n.style.height=`${t.height/t.scale}px`,n.style.overflow="hidden",n.style.backgroundColor=t.backgroundColor;const i=document.createElement("style");i.textContent=o+`
                * { 
                    font-family: 'Cairo', Arial, sans-serif !important;
                    direction: rtl !important;
                }
                body { 
                    margin: 0; 
                    padding: 0; 
                    background: ${t.backgroundColor};
                }
            `,n.appendChild(i);const c=document.createElement("div");c.innerHTML=a,n.appendChild(c),document.body.appendChild(n),await this.waitForContent(n);const{toPng:d,toJpeg:l}=await F(async()=>{const{toPng:E,toJpeg:I}=await import("./index-CyNOPa0n.js");return{toPng:E,toJpeg:I}},[]),y=await(t.format==="jpeg"?l:d)(n,{quality:t.quality,width:t.width,height:t.height,backgroundColor:t.backgroundColor,style:{transform:`scale(${t.scale})`,transformOrigin:"top left"}});return document.body.removeChild(n),y}catch(t){throw console.error("Error generating thumbnail from HTML:",t),new Error("فشل في إنشاء المعاينة من HTML")}}async addWatermark(a,o={}){try{const e={text:"سامقة © جميع الحقوق محفوظة",position:"bottom-right",fontSize:12,color:"rgba(107, 114, 128, 0.6)",backgroundColor:"rgba(255, 255, 255, 0.8)",padding:8,...o};return new Promise((t,n)=>{const i=document.createElement("canvas"),c=i.getContext("2d"),d=new Image;d.onload=()=>{i.width=d.width,i.height=d.height,c.drawImage(d,0,0),this.drawWatermark(c,i.width,i.height,e);const l=i.toDataURL("image/png",.8);t(l)},d.onerror=()=>{n(new Error("فشل في تحميل الصورة الأساسية"))},d.src=a})}catch(e){throw console.error("Error adding watermark:",e),new Error("فشل في إضافة العلامة المائية")}}drawWatermark(a,o,e,t){a.font=`${t.fontSize}px Cairo, Arial, sans-serif`,a.textAlign="right",a.textBaseline="bottom";const i=a.measureText(t.text).width,c=t.fontSize;let d,l;switch(t.position){case"top-left":d=t.padding+i,l=t.padding+c;break;case"top-right":d=o-t.padding,l=t.padding+c;break;case"bottom-left":d=t.padding+i,l=e-t.padding;break;case"bottom-right":default:d=o-t.padding,l=e-t.padding;break}t.backgroundColor&&(a.fillStyle=t.backgroundColor,a.fillRect(d-i-t.padding,l-c-t.padding/2,i+t.padding*2,c+t.padding)),a.fillStyle=t.color,a.fillText(t.text,d,l)}async waitForContent(a){document.fonts&&await document.fonts.ready;const o=a.querySelectorAll("img"),e=Array.from(o).map(t=>t.complete?Promise.resolve():new Promise((n,i)=>{t.onload=n,t.onerror=n,setTimeout(n,3e3)}));await Promise.all(e),await new Promise(t=>setTimeout(t,500))}async optimizeSize(a,o=1e5){try{return new Promise(e=>{const t=document.createElement("canvas"),n=t.getContext("2d"),i=new Image;i.onload=()=>{t.width=i.width,t.height=i.height,n.drawImage(i,0,0);let c=.8,d=t.toDataURL("image/jpeg",c);for(;d.length>o&&c>.1;)c-=.1,d=t.toDataURL("image/jpeg",c);e(d)},i.src=a})}catch(e){return console.error("Error optimizing thumbnail:",e),a}}async generateMultipleSizes(a,o=[]){const e=[{width:400,height:300,name:"medium"},{width:200,height:150,name:"small"},{width:100,height:75,name:"tiny"}],t=o.length>0?o:e,n={};try{for(const i of t){const c=await this.resizeImage(a,i.width,i.height);n[i.name]=c}return n}catch(i){throw console.error("Error generating multiple sizes:",i),new Error("فشل في إنشاء أحجام متعددة للمعاينة")}}async resizeImage(a,o,e){return new Promise((t,n)=>{const i=document.createElement("canvas"),c=i.getContext("2d"),d=new Image;d.onload=()=>{i.width=o,i.height=e;const l=Math.min(o/d.width,e/d.height),g=d.width*l,y=d.height*l,E=(o-g)/2,I=(e-y)/2;c.fillStyle="#ffffff",c.fillRect(0,0,o,e),c.drawImage(d,E,I,g,y);const N=i.toDataURL("image/png",.8);t(N)},d.onerror=()=>{n(new Error("فشل في تحميل الصورة للتغيير"))},d.src=a})}}const P=new Fe;class Oe{constructor(){this.defaultWatermark={text:"سامقة © جميع الحقوق محفوظة",position:"bottom-right",fontSize:"10px",color:"rgba(107, 114, 128, 0.6)",backgroundColor:"rgba(255, 255, 255, 0.8)",padding:"4px 8px",borderRadius:"4px",fontFamily:"Cairo, Arial, sans-serif",zIndex:"1000",pointerEvents:"none",userSelect:"none"},this.positions={"top-left":{top:"10px",left:"10px"},"top-right":{top:"10px",right:"10px"},"top-center":{top:"10px",left:"50%",transform:"translateX(-50%)"},"center-left":{top:"50%",left:"10px",transform:"translateY(-50%)"},center:{top:"50%",left:"50%",transform:"translate(-50%, -50%)"},"center-right":{top:"50%",right:"10px",transform:"translateY(-50%)"},"bottom-left":{bottom:"10px",left:"10px"},"bottom-center":{bottom:"10px",left:"50%",transform:"translateX(-50%)"},"bottom-right":{bottom:"10px",right:"10px"}}}addWatermarkToEditor(a,o={}){try{this.removeWatermarkFromEditor(a);const e={...this.defaultWatermark,...o},t=this.positions[e.position]||this.positions["bottom-right"],n={type:"text",content:e.text,style:{position:"absolute",fontSize:e.fontSize,color:e.color,backgroundColor:e.backgroundColor,padding:e.padding,borderRadius:e.borderRadius,fontFamily:e.fontFamily,zIndex:e.zIndex,pointerEvents:e.pointerEvents,userSelect:e.userSelect,direction:"ltr",...t},attributes:{"data-element-type":"watermark","data-locked":"true","data-watermark":"true",class:"watermark-element"}},i=a.addComponents(n)[0];return i.set("selectable",!1),i.set("removable",!1),i.set("draggable",!1),i.set("copyable",!1),i.set("badgable",!1),i}catch(e){throw console.error("Error adding watermark to editor:",e),new Error("فشل في إضافة العلامة المائية")}}removeWatermarkFromEditor(a){try{const o=a.getComponents(),e=[],t=n=>{const i=n.get("attributes")||{};(i["data-watermark"]==="true"||i["data-element-type"]==="watermark")&&e.push(n);const c=n.components();c&&c.length>0&&c.forEach(d=>t(d))};o.forEach(n=>t(n)),e.forEach(n=>{n.remove()})}catch(o){console.error("Error removing watermark from editor:",o)}}hasWatermark(a){try{const o=a.getHtml();return o.includes('data-watermark="true"')||o.includes('data-element-type="watermark"')||o.includes(this.defaultWatermark.text)}catch(o){return console.error("Error checking watermark:",o),!1}}addWatermarkToHTML(a,o={}){try{const e={...this.defaultWatermark,...o},t=this.positions[e.position]||this.positions["bottom-right"];if(a.includes('data-watermark="true"')||a.includes(e.text))return a;const n=`
                <div 
                    data-watermark="true" 
                    data-element-type="watermark"
                    class="watermark-element"
                    style="
                        position: absolute;
                        font-size: ${e.fontSize};
                        color: ${e.color};
                        background-color: ${e.backgroundColor};
                        padding: ${e.padding};
                        border-radius: ${e.borderRadius};
                        font-family: ${e.fontFamily};
                        z-index: ${e.zIndex};
                        pointer-events: ${e.pointerEvents};
                        user-select: ${e.userSelect};
                        direction: ltr;
                        ${Object.entries(t).map(([d,l])=>`${d}: ${l}`).join("; ")};
                    "
                >
                    ${e.text}
                </div>
            `,i=/<div[^>]*class="[^"]*container[^"]*"[^>]*>/i,c=/<body[^>]*>/i;return i.test(a)?a.replace(i,d=>d+n):c.test(a)?a.replace(c,d=>d+n):n+a}catch(e){return console.error("Error adding watermark to HTML:",e),a}}removeWatermarkFromHTML(a){try{const o=/<div[^>]*data-watermark="true"[^>]*>.*?<\/div>/gis,e=/<div[^>]*data-element-type="watermark"[^>]*>.*?<\/div>/gis,t=/<div[^>]*class="[^"]*watermark-element[^"]*"[^>]*>.*?<\/div>/gis;let n=a;return n=n.replace(o,""),n=n.replace(e,""),n=n.replace(t,""),n}catch(o){return console.error("Error removing watermark from HTML:",o),a}}addWatermarkToCSS(a,o={}){try{const e={...this.defaultWatermark,...o},t=`
                /* Watermark Protection */
                .watermark-element {
                    position: absolute !important;
                    font-size: ${e.fontSize} !important;
                    color: ${e.color} !important;
                    background-color: ${e.backgroundColor} !important;
                    padding: ${e.padding} !important;
                    border-radius: ${e.borderRadius} !important;
                    font-family: ${e.fontFamily} !important;
                    z-index: ${e.zIndex} !important;
                    pointer-events: ${e.pointerEvents} !important;
                    user-select: ${e.userSelect} !important;
                    direction: ltr !important;
                    -webkit-user-select: none !important;
                    -moz-user-select: none !important;
                    -ms-user-select: none !important;
                }

                /* Print protection */
                @media print {
                    .watermark-element {
                        display: block !important;
                        visibility: visible !important;
                        opacity: 0.8 !important;
                    }
                }

                /* Additional protection against hiding */
                .watermark-element[style*="display: none"],
                .watermark-element[style*="visibility: hidden"],
                .watermark-element[style*="opacity: 0"] {
                    display: block !important;
                    visibility: visible !important;
                    opacity: 0.6 !important;
                }
            `;return a+`
`+t}catch(e){return console.error("Error adding watermark to CSS:",e),a}}addWatermarkToCanvas(a,o={}){try{const e=a.getContext("2d"),t={...this.defaultWatermark,...o};e.font=`${parseInt(t.fontSize)}px ${t.fontFamily}`,e.textAlign="right",e.textBaseline="bottom";const i=e.measureText(t.text).width,c=parseInt(t.fontSize),d=parseInt(t.padding),l=this.positions[t.position]||this.positions["bottom-right"];let g,y;if(t.position.includes("right")?g=a.width-d:t.position.includes("left")?g=d+i:(g=a.width/2,e.textAlign="center"),t.position.includes("bottom")?y=a.height-d:t.position.includes("top")?y=d+c:(y=a.height/2,e.textBaseline="middle"),t.backgroundColor&&t.backgroundColor!=="transparent"){e.fillStyle=t.backgroundColor;const E=t.position.includes("right")?g-i-d:g-d,I=y-c-d/2;e.fillRect(E,I,i+d*2,c+d)}e.fillStyle=t.color,e.fillText(t.text,g,y)}catch(e){console.error("Error adding watermark to canvas:",e)}}validateWatermarkIntegrity(a){try{const o=a.includes('data-watermark="true"')||a.includes('data-element-type="watermark"'),e=a.includes(this.defaultWatermark.text),t=a.includes(".watermark-element");return{isValid:o||e,hasElement:o,hasText:e,hasCSS:t,warnings:[]}}catch(o){return console.error("Error validating watermark integrity:",o),{isValid:!1,hasElement:!1,hasText:!1,hasCSS:!1,warnings:["خطأ في التحقق من سلامة العلامة المائية"]}}}getWatermarkConfig(a="default"){return{editor:{...this.defaultWatermark,color:"rgba(107, 114, 128, 0.4)",fontSize:"10px"},export:{...this.defaultWatermark,color:"rgba(107, 114, 128, 0.8)",fontSize:"12px"},print:{...this.defaultWatermark,color:"rgba(0, 0, 0, 0.6)",backgroundColor:"rgba(255, 255, 255, 0.9)",fontSize:"10px"},thumbnail:{...this.defaultWatermark,color:"rgba(107, 114, 128, 0.5)",fontSize:"8px",padding:"2px 4px"}}[a]||this.defaultWatermark}}const W=new Oe,Ve={key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},Ue={class:"bg-white p-6 rounded-lg shadow-lg text-center"},Ze={class:"text-gray-700"},qe={key:1,class:"fixed top-4 right-4 z-40 space-y-2"},Ge={class:"bg-white shadow-sm border-b border-gray-200 mb-6"},Je={class:"max-w-full mx-auto px-4 sm:px-6 lg:px-8"},Qe={class:"flex justify-between items-center py-4"},Ye={class:"flex items-center space-x-4 rtl:space-x-reverse"},Xe={class:"text-sm text-gray-600"},Ke={class:"flex items-center space-x-3 rtl:space-x-reverse"},et={class:"flex items-center space-x-2 rtl:space-x-reverse"},tt={key:1,class:"flex items-center text-green-600 text-sm"},rt=["disabled"],at={key:0,class:"w-4 h-4 inline-block ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},ot={key:1,class:"animate-spin rounded-full h-4 w-4 border-b-2 border-white inline-block ml-2"},nt={class:"flex h-screen bg-gray-50",dir:"rtl"},st={class:"w-80 bg-white shadow-lg border-l border-gray-200 overflow-y-auto"},it={class:"p-4"},lt={class:"space-y-4"},dt={class:"border border-gray-200 rounded-lg p-3"},ct={class:"grid grid-cols-2 gap-2"},pt={class:"border border-gray-200 rounded-lg p-3"},ut={class:"grid grid-cols-2 gap-2"},mt={class:"border border-gray-200 rounded-lg p-3"},gt={class:"grid grid-cols-2 gap-2"},ht={class:"flex-1 flex flex-col"},ft={class:"bg-white border-b border-gray-200 p-3"},bt={class:"flex items-center justify-between"},yt={class:"flex items-center space-x-4 rtl:space-x-reverse"},vt={class:"flex items-center space-x-2 rtl:space-x-reverse"},xt={class:"text-sm text-gray-600"},wt={class:"flex items-center space-x-2 rtl:space-x-reverse"},kt=["disabled"],Ct=["disabled"],_t={class:"text-sm text-gray-600"},Et={class:"flex-1 bg-gray-100 p-8 overflow-auto"},Mt={key:2,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},At={class:"bg-white rounded-lg p-6 w-96"},St={class:"flex justify-end space-x-2 rtl:space-x-reverse"},zt={key:3,class:"fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center z-50"},It={class:"bg-white rounded-lg p-6 max-w-4xl max-h-full overflow-auto"},jt={class:"flex justify-between items-center mb-4"},$t={__name:"NewDesignEditor",props:{template:Object,categories:Array},setup(z){const a=z,o=C(!1),e=C(!1),t=C(""),n=C([]),i=C(!1),c=C(!1),d=C(null),l=C(null),g=C(1),y=C(800),E=C(600),I=C(!1),N=C(!1),J=async()=>{var p,s;try{o.value=!0,t.value="جاري تحميل محرر التصميم...";const m=(await F(async()=>{const{default:u}=await import("./grapes-D3xufpkI.js");return{default:u}},[])).default;if(l.value=m.init({container:"#gjs-editor",width:"100%",height:"100%",fromElement:!1,showOffsets:!0,noticeOnUnload:!1,storageManager:!1,canvas:{styles:["https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap","https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap","https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;600;700&display=swap"],scripts:[]},deviceManager:{devices:[{name:"بطاقة قياسية",width:"800px",height:"600px"},{name:"بطاقة مربعة",width:"600px",height:"600px"},{name:"بطاقة طولية",width:"600px",height:"800px"}]},blockManager:{appendTo:!1,blocks:[]},styleManager:He,layerManager:{appendTo:"#element-properties"},panels:{defaults:[]},richTextEditor:{actions:["bold","italic","underline","strikethrough"],config:{direction:"rtl"}},assetManager:{embedAsBase64:!1,upload:!1,uploadText:"رفع الصور هنا أو انقر للتصفح",addBtnText:"إضافة صورة"}}),Re(l.value),a.template.design_data)try{const u=typeof a.template.design_data=="string"?JSON.parse(a.template.design_data):a.template.design_data,M=R.validateDesignData(u);if(!M.isValid)console.warn("Design data validation failed:",M.errors),v("بيانات التصميم قد تكون تالفة، سيتم تحميل قالب افتراضي","warning"),H();else if(R.loadDesignData(l.value,u))v("تم تحميل التصميم بنجاح","success"),(p=u.metadata)!=null&&p.canvasWidth&&((s=u.metadata)!=null&&s.canvasHeight)&&(y.value=u.metadata.canvasWidth,E.value=u.metadata.canvasHeight);else throw new Error("Failed to load design data")}catch(u){console.error("Error loading design data:",u),v("خطأ في تحميل التصميم المحفوظ، سيتم تحميل قالب افتراضي","error"),H()}else H();Q(),o.value=!1}catch(m){console.error("Error initializing editor:",m),v("خطأ في تحميل المحرر","error"),o.value=!1}},H=()=>{l.value.setComponents(`
        <div style="width: 100%; height: 100%; position: relative; background: linear-gradient(135deg, #f8fafc 0%, #e2e8f0 100%); display: flex; align-items: center; justify-content: center;">
            <div style="text-align: center; font-family: Cairo, Arial, sans-serif;">
                <h1 style="font-size: 48px; color: #1e293b; margin-bottom: 20px;" data-editable="true" data-element-type="heading">
                    مرحباً بك في محرر التصميم
                </h1>
                <p style="font-size: 18px; color: #64748b; margin-bottom: 30px;" data-editable="true" data-element-type="text">
                    ابدأ بإضافة العناصر من الشريط الجانبي
                </p>
                <div style="position: absolute; bottom: 20px; right: 20px; opacity: 0.3; font-size: 12px; color: #94a3b8;">
                    سامقة © جميع الحقوق محفوظة
                </div>
            </div>
        </div>
    `)},Q=()=>{l.value.on("component:selected",p=>{L()}),l.value.on("component:update",()=>{L()}),l.value.on("canvas:drop",()=>{L()})},L=()=>{const p=l.value.UndoManager;I.value=p.hasUndo(),N.value=p.hasRedo()},j=p=>{if(!l.value)return;const s=l.value.BlockManager,u={text:"arabic-text",heading:"arabic-heading",image:"logo-placeholder",button:"arabic-button",icon:"islamic-pattern",shape:"decorative-border"}[p]||p,M=s.get(u);if(M){const A=l.value.addComponents(M.get("content"))[0];l.value.select(A),v(`تم إضافة ${O(p)}`,"success")}else Y(p)},Y=p=>{let s={};switch(p){case"text":s={type:"text",content:"أدخل النص هنا",style:{"font-family":"Cairo, Arial, sans-serif","font-size":"16px",color:"#333333",padding:"10px",direction:"rtl","text-align":"right"},attributes:{"data-editable":"true","data-element-type":"text"}};break;case"heading":s={tagName:"h1",type:"text",content:"عنوان رئيسي",style:{"font-family":"Cairo, Arial, sans-serif","font-size":"32px","font-weight":"bold",color:"#1e293b",margin:"10px 0",direction:"rtl","text-align":"center"},attributes:{"data-editable":"true","data-element-type":"heading"}};break;case"image":s={type:"image",style:{width:"150px",height:"100px","object-fit":"cover","border-radius":"8px"},attributes:{"data-element-type":"image",src:"https://via.placeholder.com/150x100/e2e8f0/64748b?text=صورة"}};break;case"button":s={tagName:"button",type:"text",content:"انقر هنا",style:{background:"linear-gradient(135deg, #3b82f6 0%, #1d4ed8 100%)",color:"white",padding:"12px 24px",border:"none","border-radius":"8px","font-family":"Cairo, Arial, sans-serif","font-size":"16px",cursor:"pointer",direction:"rtl"},attributes:{"data-editable":"true","data-element-type":"button"}};break;default:return}const m=l.value.addComponents(s)[0];l.value.select(m),v(`تم إضافة ${O(p)}`,"success")},O=p=>({text:"نص",heading:"عنوان",image:"صورة",button:"زر",icon:"أيقونة",shape:"شكل"})[p]||p,X=()=>{g.value<2&&(g.value+=.1)},K=()=>{g.value>.3&&(g.value-=.1)},ee=()=>{l.value&&I.value&&(l.value.UndoManager.undo(),L())},te=()=>{l.value&&N.value&&(l.value.UndoManager.redo(),L())},re=()=>{i.value=!0},ae=p=>{const s=p.target.files[0];s&&s.type.startsWith("image/")?d.value=s:v("يرجى اختيار ملف صورة صحيح","error")},oe=()=>{if(!d.value||!l.value)return;const p=new FileReader;p.onload=s=>{const m=s.target.result;l.value.getWrapper().setStyle({"background-image":`url(${m})`,"background-size":"cover","background-position":"center","background-repeat":"no-repeat"}),i.value=!1,d.value=null,v("تم تطبيق صورة الخلفية بنجاح","success")},p.readAsDataURL(d.value)},ne=()=>{if(!l.value)return;const p=l.value.getHtml(),m=`
        <style>
            ${l.value.getCss()}
            body { margin: 0; font-family: Cairo, Arial, sans-serif; }
            .watermark {
                position: absolute;
                bottom: 10px;
                right: 10px;
                opacity: 0.5;
                font-size: 12px;
                color: #666;
                background: rgba(255,255,255,0.8);
                padding: 5px 10px;
                border-radius: 4px;
            }
        </style>
        <div style="position: relative; width: ${y.value}px; height: ${E.value}px;">
            ${p}
            <div class="watermark">سامقة © جميع الحقوق محفوظة</div>
        </div>
    `;c.value=!0,he(()=>{const u=document.getElementById("preview-container");u&&(u.innerHTML=m)})},V=()=>{if(l.value)try{const p=W.getWatermarkConfig("editor");W.addWatermarkToEditor(l.value,p)&&v("تم إضافة العلامة المائية بنجاح","success")}catch(p){console.error("Error adding watermark:",p),v("خطأ في إضافة العلامة المائية","error")}},U=()=>l.value?W.hasWatermark(l.value):!1,Z=async()=>{if(l.value)try{o.value=!0,t.value="جاري إنشاء المعاينة...";const p=await P.generateFromEditor(l.value,{width:400,height:300,quality:.8,format:"png"}),s=W.getWatermarkConfig("thumbnail"),m=await P.addWatermark(p,{text:s.text,position:s.position,fontSize:parseInt(s.fontSize),color:s.color,backgroundColor:s.backgroundColor}),u=await P.optimizeSize(m,15e4),M=await fetch(route("admin.templates.thumbnail.generate",a.template.id),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({thumbnail_data:u})});if(M.ok){const A=await M.json();v("تم إنشاء المعاينة بنجاح","success"),A.thumbnail_url&&(a.template.thumbnail_url=A.thumbnail_url)}else{const A=await M.json();throw new Error(A.message||"Failed to save thumbnail")}o.value=!1}catch(p){console.error("Error generating thumbnail:",p),v(p.message||"خطأ في إنشاء المعاينة","error"),o.value=!1}},se=async()=>{var p,s;if(l.value)try{e.value=!0;const m=R.processDesignData(l.value,{canvasWidth:y.value,canvasHeight:E.value,category:(p=a.template.category)==null?void 0:p.name,templateName:a.template.name,createdBy:"admin"}),u=R.validateDesignData(m);if(!u.isValid)throw new Error(u.errors.join(", "));u.warnings.length>0&&u.warnings.forEach($=>{v($,"warning")}),U()||(V(),v("تم إضافة العلامة المائية تلقائياً","info")),W.validateWatermarkIntegrity(m.design.html).isValid||v("تحذير: العلامة المائية قد تكون مفقودة أو تالفة","warning");const A=await fetch(route("admin.templates.design.save",a.template.id),{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},body:JSON.stringify({design_data:JSON.stringify(m),editable_elements:m.editableElements,canvas_size:`${y.value}x${E.value}`,background_image:((s=m.assets)==null?void 0:s.backgroundImage)||null,design_notes:`تم التحديث في ${new Date().toLocaleString("ar-SA")}`})});if(A.ok){const $=await A.json();v("تم حفظ التصميم بنجاح","success"),$.template&&Object.assign(a.template,$.template),m.editableElements&&m.editableElements.length>0&&setTimeout(()=>{Z()},1e3)}else{const $=await A.json();throw new Error($.message||"Failed to save design")}e.value=!1}catch(m){console.error("Error saving design:",m),v(m.message||"خطأ في حفظ التصميم","error"),e.value=!1}},v=(p,s="info")=>{const m={id:Date.now(),message:p,type:s};n.value.push(m),setTimeout(()=>{const u=n.value.findIndex(M=>M.id===m.id);u>-1&&n.value.splice(u,1)},3e3)};return ie(()=>{J()}),le(()=>{l.value&&l.value.destroy()}),(p,s)=>(k(),de(Be,null,{default:w(()=>{var m;return[x(f(ce),{title:"محرر التصميم المتقدم"}),o.value?(k(),_("div",Ve,[r("div",Ue,[s[8]||(s[8]=r("div",{class:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"},null,-1)),r("p",Ze,h(t.value),1)])])):B("",!0),n.value.length>0?(k(),_("div",qe,[(k(!0),_(pe,null,ue(n.value,u=>(k(),_("div",{key:u.id,class:S(["p-4 rounded-lg shadow-lg transition-all duration-300",u.type==="success"?"bg-green-500 text-white":"bg-red-500 text-white"])},h(u.message),3))),128))])):B("",!0),r("div",Ge,[r("div",Je,[r("div",Qe,[r("div",Ye,[x(f(me),{href:p.route("admin.templates.index"),class:"text-gray-500 hover:text-gray-700 transition-colors"},{default:w(()=>s[9]||(s[9]=[r("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M10 19l-7-7m0 0l7-7m-7 7h18"})],-1)])),_:1,__:[9]},8,["href"]),r("div",null,[s[10]||(s[10]=r("h1",{class:"text-2xl font-bold text-gray-900"},"محرر التصميم المتقدم",-1)),r("p",Xe,h(z.template.name)+" - "+h((m=z.template.category)==null?void 0:m.name),1)])]),r("div",Ke,[r("button",{onClick:re,class:"bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors"},s[11]||(s[11]=[r("svg",{class:"w-4 h-4 inline-block ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),b(" صورة الخلفية ")])),r("button",{onClick:Z,class:"bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded-lg transition-colors"},s[12]||(s[12]=[r("svg",{class:"w-4 h-4 inline-block ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"})],-1),b(" إنشاء معاينة ")])),r("div",et,[U()?(k(),_("span",tt,s[14]||(s[14]=[r("svg",{class:"w-4 h-4 ml-1",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})],-1),b(" العلامة المائية موجودة ")]))):(k(),_("button",{key:0,onClick:V,class:"bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors"},s[13]||(s[13]=[r("svg",{class:"w-4 h-4 inline-block ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"})],-1),b(" إضافة العلامة المائية ")])))]),r("button",{onClick:ne,class:"bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors"},s[15]||(s[15]=[r("svg",{class:"w-4 h-4 inline-block ml-2",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"}),r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"})],-1),b(" معاينة ")])),r("button",{onClick:se,disabled:e.value,class:"bg-green-500 hover:bg-green-600 disabled:bg-gray-400 text-white px-6 py-2 rounded-lg transition-colors"},[e.value?(k(),_("div",ot)):(k(),_("svg",at,s[16]||(s[16]=[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"},null,-1)]))),b(" "+h(e.value?"جاري الحفظ...":"حفظ التصميم"),1)],8,rt)])])])]),r("div",nt,[r("div",st,[r("div",it,[s[26]||(s[26]=r("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"عناصر التصميم",-1)),r("div",lt,[r("div",dt,[s[19]||(s[19]=r("h4",{class:"font-medium text-gray-700 mb-3"},"عناصر النص",-1)),r("div",ct,[r("div",{onClick:s[0]||(s[0]=u=>j("text")),class:"p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition-colors text-center"},s[17]||(s[17]=[r("svg",{class:"w-6 h-6 mx-auto mb-1 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 12h16M4 18h7"})],-1),r("span",{class:"text-xs text-gray-600"},"نص",-1)])),r("div",{onClick:s[1]||(s[1]=u=>j("heading")),class:"p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition-colors text-center"},s[18]||(s[18]=[r("svg",{class:"w-6 h-6 mx-auto mb-1 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 6h16M4 10h16M4 14h16M4 18h16"})],-1),r("span",{class:"text-xs text-gray-600"},"عنوان",-1)]))])]),r("div",pt,[s[22]||(s[22]=r("h4",{class:"font-medium text-gray-700 mb-3"},"عناصر الوسائط",-1)),r("div",ut,[r("div",{onClick:s[2]||(s[2]=u=>j("image")),class:"p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition-colors text-center"},s[20]||(s[20]=[r("svg",{class:"w-6 h-6 mx-auto mb-1 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z"})],-1),r("span",{class:"text-xs text-gray-600"},"صورة",-1)])),r("div",{onClick:s[3]||(s[3]=u=>j("icon")),class:"p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition-colors text-center"},s[21]||(s[21]=[r("svg",{class:"w-6 h-6 mx-auto mb-1 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"})],-1),r("span",{class:"text-xs text-gray-600"},"أيقونة",-1)]))])]),r("div",mt,[s[25]||(s[25]=r("h4",{class:"font-medium text-gray-700 mb-3"},"عناصر تفاعلية",-1)),r("div",gt,[r("div",{onClick:s[4]||(s[4]=u=>j("button")),class:"p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition-colors text-center"},s[23]||(s[23]=[r("svg",{class:"w-6 h-6 mx-auto mb-1 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M15 15l-2 5L9 9l11 4-5 2zm0 0l5 5M7.188 2.239l.777 2.897M5.136 7.965l-2.898-.777M13.95 4.05l-2.122 2.122m-5.657 5.656l-2.12 2.122"})],-1),r("span",{class:"text-xs text-gray-600"},"زر",-1)])),r("div",{onClick:s[5]||(s[5]=u=>j("shape")),class:"p-3 border border-gray-300 rounded-lg cursor-pointer hover:bg-blue-50 hover:border-blue-300 transition-colors text-center"},s[24]||(s[24]=[r("svg",{class:"w-6 h-6 mx-auto mb-1 text-gray-600",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M20 7l-8-4-8 4m16 0l-8 4m8-4v10l-8 4m0-10L4 7m8 4v10M4 7v10l8 4"})],-1),r("span",{class:"text-xs text-gray-600"},"شكل",-1)]))])])])])]),r("div",ht,[r("div",ft,[r("div",bt,[r("div",yt,[r("div",vt,[r("button",{onClick:K,class:"p-2 text-gray-600 hover:text-gray-900"},s[27]||(s[27]=[r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"})],-1)])),r("span",xt,h(Math.round(g.value*100))+"%",1),r("button",{onClick:X,class:"p-2 text-gray-600 hover:text-gray-900"},s[28]||(s[28]=[r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v3m0 0v3m0-3h3m-3 0H7"})],-1)]))]),r("div",wt,[r("button",{onClick:ee,disabled:!I.value,class:"p-2 text-gray-600 hover:text-gray-900 disabled:text-gray-300"},s[29]||(s[29]=[r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M3 10h10a8 8 0 018 8v2M3 10l6 6m-6-6l6-6"})],-1)]),8,kt),r("button",{onClick:te,disabled:!N.value,class:"p-2 text-gray-600 hover:text-gray-900 disabled:text-gray-300"},s[30]||(s[30]=[r("svg",{class:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M21 10h-10a8 8 0 00-8 8v2m18-10l-6 6m6-6l-6-6"})],-1)]),8,Ct)])]),r("div",_t,h(y.value)+" × "+h(E.value)+" px ",1)])]),r("div",Et,[r("div",{class:"mx-auto bg-white shadow-lg",style:ge({width:y.value+"px",height:E.value+"px",transform:`scale(${g.value})`})},s[31]||(s[31]=[r("div",{id:"gjs-editor",class:"w-full h-full"},null,-1)]),4)])]),s[32]||(s[32]=r("div",{class:"w-80 bg-white shadow-lg border-r border-gray-200 overflow-y-auto"},[r("div",{class:"p-4"},[r("h3",{class:"text-lg font-semibold text-gray-900 mb-4"},"خصائص العنصر"),r("div",{id:"element-properties",class:"space-y-4"},[r("div",{class:"text-center text-gray-500 py-8"}," اختر عنصراً لتحرير خصائصه ")])])],-1))]),i.value?(k(),_("div",Mt,[r("div",At,[s[33]||(s[33]=r("h3",{class:"text-lg font-semibold mb-4"},"رفع صورة الخلفية",-1)),r("input",{type:"file",onChange:ae,accept:"image/*",class:"w-full mb-4"},null,32),r("div",St,[r("button",{onClick:s[6]||(s[6]=u=>i.value=!1),class:"px-4 py-2 text-gray-600 hover:text-gray-800"},"إلغاء"),r("button",{onClick:oe,class:"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600"},"تطبيق")])])])):B("",!0),c.value?(k(),_("div",zt,[r("div",It,[r("div",jt,[s[35]||(s[35]=r("h3",{class:"text-lg font-semibold"},"معاينة التصميم",-1)),r("button",{onClick:s[7]||(s[7]=u=>c.value=!1),class:"text-gray-500 hover:text-gray-700"},s[34]||(s[34]=[r("svg",{class:"w-6 h-6",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24"},[r("path",{"stroke-linecap":"round","stroke-linejoin":"round","stroke-width":"2",d:"M6 18L18 6M6 6l12 12"})],-1)]))]),s[36]||(s[36]=r("div",{id:"preview-container",class:"border border-gray-200 rounded-lg"},null,-1))])])):B("",!0)]}),_:1}))}},Ht=ve($t,[["__scopeId","data-v-e8ce3a1f"]]);export{Ht as default};
