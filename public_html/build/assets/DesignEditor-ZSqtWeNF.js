import{r as v,m as Z,p as ft,c as y,o as m,a as j,b as s,w as we,u as xe,Z as mt,d as T,t as w,F as U,f as B,n as _,i as yt,q as se,h as $e,j as bt,v as wt,s as ne,e as xt,g as $t}from"./app-BJSEvLr2.js";import{E as ke,L as kt,P as Ct,a as Et,D as Tt}from"./DesignElement-afgWAcdT.js";import{_ as Pt}from"./_plugin-vue_export-helper-DlAUqK2U.js";const St={class:"min-h-screen bg-gray-100",dir:"rtl"},Dt={class:"bg-white shadow-sm border-b border-gray-200"},It={class:"max-w-full mx-auto px-6 py-4"},At={class:"flex justify-between items-center"},Mt={class:"flex items-center space-x-4 space-x-reverse"},Rt={class:"text-sm text-gray-600"},_t={class:"flex items-center space-x-3 space-x-reverse"},Ot={class:"flex items-center bg-gray-100 rounded-lg p-1"},Lt=["disabled"],Nt=["disabled"],zt={class:"flex items-center bg-gray-100 rounded-lg p-1"},jt=["onClick","title"],Ut=["disabled"],Wt={class:"flex h-screen"},Ft={class:"w-80 bg-white border-l border-gray-200 flex flex-col"},Bt={class:"flex-shrink-0 border-b border-gray-200"},Vt={class:"flex"},Gt=["onClick"],Xt={class:"flex-1 overflow-hidden"},Ht={key:0,class:"h-full"},Kt={key:1,class:"h-full"},qt={key:2,class:"h-full"},Jt={class:"flex-1 bg-gray-50 flex flex-col"},Yt={class:"flex-shrink-0 bg-white border-b border-gray-200 p-4"},Qt={class:"flex items-center justify-between"},Zt={class:"flex items-center space-x-4 space-x-reverse"},eo={class:"flex items-center space-x-2 space-x-reverse"},to={class:"text-sm text-gray-600 min-w-16 text-center"},oo={class:"flex-1 overflow-auto p-8 flex items-center justify-center"},ao={class:"bg-white rounded-lg shadow-xl max-w-6xl max-h-[90vh] w-full mx-4"},lo={key:1,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-40"},so={class:"bg-white rounded-lg p-8 flex items-center space-x-4 space-x-reverse"},no={class:"text-lg font-medium"},io={key:2,class:"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50"},ro={key:3,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50"},co={class:"bg-white rounded-lg shadow-xl p-8 max-w-2xl w-full mx-4 max-h-[90vh] overflow-y-auto"},uo={class:"mb-6"},go={class:"grid grid-cols-1 md:grid-cols-2 gap-3 max-h-60 overflow-y-auto"},ho=["onClick"],po={class:"font-medium text-sm"},vo={class:"text-xs text-gray-500 mt-1"},fo={key:0,class:"text-xs text-purple-600 mt-1"},mo={class:"mb-6"},yo={class:"grid grid-cols-2 gap-3"},bo=["onClick"],wo={class:"font-medium"},xo={class:"text-xs text-gray-500"},$o={key:0,class:"mb-6"},ko={class:"text-center text-sm text-gray-600 mt-1"},Co={class:"mb-6 p-4 bg-gray-50 rounded-lg"},Eo={class:"text-sm text-gray-600 space-y-1"},To={key:0},Po={class:"flex justify-center gap-4"},So=["disabled"],Do={key:0},Io={key:1},Ao={__name:"DesignEditor",props:{template:{type:Object,required:!0},clientTemplate:{type:Object,default:null},mode:{type:String,default:"create"}},setup(ie){const D=ie,P=v("elements"),V=v("desktop"),x=v(1),Ce=v(!1);v(!1);const g=v(800),h=v(600),W=v(!1),Ee=v(!1),Te=v(""),re=v(!1),ce=v(null),k=v(""),O=v("contain"),C=v(!0),L=v(null),F=v(!1),N=v(null),G=v(!1),I=v("png"),E=v("current"),X=v(90),z=v(!1),r=v([]),f=v(null),R=v([]),A=v(-1),de=v(null),H=v(null),Pe=[{id:"elements",name:"العناصر",icon:"fas fa-shapes"},{id:"layers",name:"الطبقات",icon:"fas fa-layer-group"},{id:"properties",name:"الخصائص",icon:"fas fa-cog"}],ue=[{value:"png",label:"PNG",description:"جودة عالية مع شفافية",icon:"fas fa-file-image"},{value:"jpeg",label:"JPEG",description:"حجم أصغر للصور",icon:"fas fa-image"},{value:"svg",label:"SVG",description:"رسوميات متجهة قابلة للتكبير",icon:"fas fa-vector-square"},{value:"pdf",label:"PDF",description:"مستند قابل للطباعة",icon:"fas fa-file-pdf"}],K=[{value:"current",label:"الحجم الحالي",description:"استخدام أبعاد التصميم الحالية",width:null,height:null,dpi:72},{value:"a4-portrait",label:"A4 عمودي",description:"210 × 297 مم - جودة طباعة عالية",width:2480,height:3508,dpi:300},{value:"a4-landscape",label:"A4 أفقي",description:"297 × 210 مم - جودة طباعة عالية",width:3508,height:2480,dpi:300},{value:"a5-portrait",label:"A5 عمودي",description:"148 × 210 مم - مناسب للبروشورات",width:1748,height:2480,dpi:300},{value:"a5-landscape",label:"A5 أفقي",description:"210 × 148 مم - مناسب للبروشورات",width:2480,height:1748,dpi:300},{value:"hd-169",label:"16:9 HD",description:"1920 × 1080 بكسل - مناسب للعروض",width:1920,height:1080,dpi:72},{value:"4k-169",label:"16:9 4K",description:"3840 × 2160 بكسل - جودة فائقة",width:3840,height:2160,dpi:72},{value:"square-hd",label:"مربع HD",description:"1080 × 1080 بكسل - مناسب لوسائل التواصل",width:1080,height:1080,dpi:72},{value:"instagram-post",label:"منشور إنستغرام",description:"1080 × 1080 بكسل - مُحسَّن للإنستغرام",width:1080,height:1080,dpi:72},{value:"instagram-story",label:"ستوري إنستغرام",description:"1080 × 1920 بكسل - مُحسَّن للستوريز",width:1080,height:1920,dpi:72},{value:"facebook-cover",label:"غلاف فيسبوك",description:"1200 × 630 بكسل - مُحسَّن لفيسبوك",width:1200,height:630,dpi:72},{value:"business-card",label:"بطاقة عمل",description:"89 × 51 مم - حجم بطاقة عمل قياسي",width:1050,height:600,dpi:300}],Se=[{id:"desktop",name:"سطح المكتب",icon:"fas fa-desktop"},{id:"tablet",name:"تابلت",icon:"fas fa-tablet-alt"},{id:"mobile",name:"موبايل",icon:"fas fa-mobile-alt"}],ge=Z(()=>A.value>0),he=Z(()=>A.value<R.value.length-1),De=Z(()=>r.value.map((e,t)=>({id:e.id,name:e.name||`عنصر ${t+1}`,type:e.type,visible:e.visible!==!1,locked:e.locked||!1}))),Ie=Z(()=>{const e=20*x.value;return{backgroundImage:`
            linear-gradient(to right, #e5e7eb 1px, transparent 1px),
            linear-gradient(to bottom, #e5e7eb 1px, transparent 1px)
        `,backgroundSize:`${e}px ${e}px`}}),Ae=e=>{switch(V.value=e,e){case"desktop":g.value=1200,h.value=800;break;case"tablet":g.value=768,h.value=1024;break;case"mobile":g.value=375,h.value=667;break}},Me=()=>{x.value=Math.min(x.value+.1,3)},Re=()=>{x.value=Math.max(x.value-.1,.1)},_e=e=>{if(e.type==="image"){const t={id:M(),type:e.type,name:e.name,x:g.value/2-100,y:h.value/2-100,width:e.width||200,height:e.height||100,rotation:0,opacity:1,visible:!0,locked:!1,zIndex:r.value.length,...e.properties};r.value.push(t),f.value=t,$()}else L.value=e},Oe=e=>{f.value={...e,properties:e.properties?{...e.properties}:void 0},P.value="properties"},Le=e=>{const t=r.value.find(a=>a.id===e);t&&(f.value={...t,properties:t.properties?{...t.properties}:void 0},P.value="properties")},Ne=(e,t)=>{const a=r.value.findIndex(i=>i.id===e);a!==-1&&(r.value[a]={...r.value[a],...t},$())},ee=e=>{var a;const t=r.value.findIndex(i=>i.id===e);t!==-1&&(r.value.splice(t,1),((a=f.value)==null?void 0:a.id)===e&&(f.value=null),$())},ze=e=>{const t=e.map(a=>r.value.find(i=>i.id===a)).filter(Boolean);r.value=t,Q(),$()},je=e=>{if(L.value){const t=H.value.getBoundingClientRect(),a=(e.clientX-t.left)/x.value,i=(e.clientY-t.top)/x.value,o=L.value,l={id:M(),type:o.type,name:o.name,x:a,y:i,width:o.width||200,height:o.height||100,rotation:0,opacity:1,visible:!0,locked:!1,zIndex:r.value.length,...o.properties};r.value.push(l),f.value=l,$(),L.value=null}else e.target===H.value&&(f.value=null)},Ue=e=>{e.preventDefault(),Array.from(e.dataTransfer.files).forEach(a=>{if(a.type.startsWith("image/")){const i=new FileReader;i.onload=o=>{const l={id:M(),type:"image",name:a.name,x:e.offsetX,y:e.offsetY,width:300,height:200,rotation:0,opacity:1,visible:!0,locked:!1,zIndex:r.value.length,src:o.target.result};r.value.push(l),f.value=l,$()},i.readAsDataURL(a)}})},$=()=>{R.value=R.value.slice(0,A.value+1),R.value.push(JSON.parse(JSON.stringify(r.value))),A.value++,R.value.length>50&&(R.value.shift(),A.value--)},pe=()=>{ge.value&&(A.value--,r.value=JSON.parse(JSON.stringify(R.value[A.value])),f.value=null)},te=()=>{he.value&&(A.value++,r.value=JSON.parse(JSON.stringify(R.value[A.value])),f.value=null)},M=()=>"element_"+Date.now()+"_"+Math.random().toString(36).substr(2,9),We=(e,t=800,a=.7)=>new Promise(i=>{if(!e.startsWith("data:image/")){i(e);return}const o=new Image;o.onload=()=>{const l=document.createElement("canvas"),c=l.getContext("2d");let{width:d,height:u}=o;const p=e.length;p>1e6?(t=600,a=.5):p>5e5&&(t=700,a=.6),(d>t||u>t)&&(d>u?(u=u*t/d,d=t):(d=d*t/u,u=t)),l.width=d,l.height=u,c.drawImage(o,0,0,d,u);const n=l.toDataURL("image/jpeg",a);console.log(`Image compressed: ${Math.round(p/1024)}KB -> ${Math.round(n.length/1024)}KB`),i(n)},o.src=e}),ve=async()=>{var e,t;W.value=!0;try{if(!((e=D.template)!=null&&e.id))throw new Error("Template ID is missing");const a=(t=document.querySelector('meta[name="csrf-token"]'))==null?void 0:t.content;if(!a)throw new Error("CSRF token not found");console.log("Compressing images...");const i=await Promise.all((r.value||[]).map(async u=>{if(u.type==="image"&&u.src&&u.src.startsWith("data:image/")){const p=await We(u.src);return{...u,src:p}}return u}));console.log("Image compression complete");const o={elements:i,canvas:{width:g.value||800,height:h.value||600,background:k.value||"",backgroundSize:O.value||"contain"},settings:{device:V.value||"desktop",zoom:x.value||1},watermark:{text:"سامقة للتصميم",enabled:!0,position:"bottom-right",style:{fontSize:"14px",color:"rgba(0, 0, 0, 0.25)",fontFamily:"Cairo, sans-serif",fontWeight:"bold",rotation:"-15deg"}}};let l;try{l=JSON.stringify(o);const u=new Blob([l]).size;if(u>16777215)throw new Error(`بيانات التصميم كبيرة جداً (${Math.round(u/1024/1024)}MB). يرجى تقليل حجم الصور.`)}catch(u){throw new Error("Invalid design data: "+u.message)}console.log("Saving design data:",o),console.log("Template ID:",D.template.id),console.log("Data size:",Math.round(new Blob([l]).size/1024),"KB");const c={design_data:l};console.log("Request payload size:",Math.round(new Blob([JSON.stringify(c)]).size/1024),"KB");const d=await fetch(`/client/templates/${D.template.id}/design`,{method:"POST",headers:{"Content-Type":"application/json","X-CSRF-TOKEN":a},body:JSON.stringify(c)});if(d.ok){const u=await d.json();console.log("Design saved successfully",u),u.success&&alert("تم حفظ التصميم بنجاح")}else{let u="Failed to save design";try{const p=await d.json();u=p.message||u,console.error("Server error details:",p)}catch(p){console.error("Could not parse error response:",p)}throw console.error("HTTP Status:",d.status,d.statusText),new Error(u)}}catch(a){console.error("Error saving design:",a);let i="خطأ في حفظ التصميم";a.message&&(i+=": "+a.message),alert(i)}finally{W.value=!1}},Fe=()=>{const e={elements:r.value,canvas:{width:g.value,height:h.value}};window.open("","_blank").document.write(oe(e))},oe=e=>{let t=`
        <!DOCTYPE html>
        <html dir="rtl">
        <head>
            <meta charset="UTF-8">
            <title>معاينة التصميم</title>
            <style>
                @import url('https://fonts.googleapis.com/css2?family=Cairo:wght@400;700&display=swap');
                @import url('https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css');
                body {
                    margin: 0;
                    padding: 20px;
                    font-family: 'Cairo', sans-serif;
                    background: #f5f5f5;
                }
                .canvas {
                    width: ${e.canvas.width}px;
                    height: ${e.canvas.height}px;
                    position: relative;
                    background: white;
                    border: 1px solid #ddd;
                    margin: 0 auto;
                    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
                    ${k.value?`
                        background-image: url(${k.value});
                        background-size: ${O.value};
                        background-position: center;
                        background-repeat: no-repeat;
                    `:""}
                }
                .element { position: absolute; }
                h2 { text-align: center; color: #333; margin-bottom: 20px; }
                .footer {
                    text-align: center;
                    margin-top: 20px;
                    color: #666;
                    font-size: 12px;
                }
            </style>
        </head>
        <body>
            <h2>معاينة التصميم - سامقة</h2>
            <div class="canvas">
    `;return e.elements.forEach(a=>{a.visible!==!1&&(t+=Be(a))}),t+=`
                <!-- Always show watermark in preview -->
                <div style="
                    position: absolute;
                    top: 50%;
                    left: 50%;
                    font-size: 48px;
                    color: rgba(0, 0, 0, 0.08);
                    font-family: 'Cairo', sans-serif;
                    font-weight: bold;
                    z-index: 9999;
                    transform: translate(-50%, -50%) rotate(-45deg);
                    transform-origin: center;
                    user-select: none;
                    letter-spacing: 2px;
                    pointer-events: none;
                    white-space: nowrap;
                ">منصة سامقة للتصميم</div>
            </div>
            <div class="footer">
                <p>© ${new Date().getFullYear()} سامقة للتصميم - جميع الحقوق محفوظة</p>
                <p>تم إنشاء هذا التصميم باستخدام منصة سامقة للتصميم</p>
            </div>
        </body>
        </html>
    `,t},Be=e=>{const t=`
        left: ${e.x}px;
        top: ${e.y}px;
        width: ${e.width}px;
        height: ${e.height}px;
        transform: rotate(${e.rotation}deg);
        opacity: ${e.opacity};
        z-index: ${e.zIndex};
    `;switch(e.type){case"text":return`<div class="element" style="${t} font-size: ${e.fontSize||16}px; color: ${e.color||"#000"}; font-weight: ${e.fontWeight||"normal"};">${e.text||"نص"}</div>`;case"image":return`<img class="element" src="${e.src}" style="${t} object-fit: cover;" alt="${e.name}">`;case"rectangle":return`<div class="element" style="${t} background-color: ${e.backgroundColor||"#000"}; border-radius: ${e.borderRadius||0}px;"></div>`;case"circle":return`<div class="element" style="${t} background-color: ${e.backgroundColor||"#10b981"}; border-radius: 50%;"></div>`;case"shape":return st(e,t);case"icon":const a=J(e.iconClass||"fas fa-star");return`<div class="element" style="${t} display: flex; align-items: center; justify-content: center; background-color: ${e.color||"#374151"}; border-radius: 50%;">
                <span style="font-size: ${(e.fontSize||24)*.6}px; color: white;">${a}</span>
            </div>`;default:return""}},fe=(e,t,a,i,o,l)=>{let c=Math.PI/2*3,d=t,u=a;const p=Math.PI/i;e.beginPath(),e.moveTo(t,a-o);for(let n=0;n<i;n++)d=t+Math.cos(c)*o,u=a+Math.sin(c)*o,e.lineTo(d,u),c+=p,d=t+Math.cos(c)*l,u=a+Math.sin(c)*l,e.lineTo(d,u),c+=p;e.lineTo(t,a-o),e.closePath()},Ve=(e,t,a,i,o)=>{let l=[],c=Math.PI/2*3;const d=Math.PI/a;for(let u=0;u<a;u++){let p=e+Math.cos(c)*i,n=t+Math.sin(c)*i;l.push(`${p},${n}`),c+=d,p=e+Math.cos(c)*o,n=t+Math.sin(c)*o,l.push(`${p},${n}`),c+=d}return l.join(" ")},Ge=()=>{const e=K.find(t=>t.value===E.value);return!e||e.value==="current"?`${g.value} × ${h.value} بكسل`:`${e.width} × ${e.height} بكسل (${e.dpi} DPI)`},Xe=()=>{let e=null;if(D.clientTemplate&&D.clientTemplate.design_data?(e=D.clientTemplate.design_data,console.log("Loading from clientTemplate:",e)):D.template.design_data&&(e=D.template.design_data,console.log("Loading from template:",e)),e)try{let t;if(typeof e=="string")t=JSON.parse(e);else if(typeof e=="object")t=e;else throw new Error("Invalid design data format");r.value=t.elements||[],t.canvas&&(g.value=t.canvas.width||800,h.value=t.canvas.height||600,k.value=t.canvas.background||"",O.value=t.canvas.backgroundSize||"contain"),t.settings&&(V.value=t.settings.device||"desktop",x.value=t.settings.zoom||1),console.log("Design loaded successfully:",{elementsCount:r.value.length,canvas:{width:g.value,height:h.value},mode:D.mode}),$()}catch(t){console.error("Error loading design:",t),r.value=[],$()}else console.log("No design data found, initializing empty design"),r.value=[],$()},me=()=>{re.value=!1,ce.value=null},He=e=>{console.log("Photo edited:",e),me()},Ke=()=>{const e={id:M(),type:"shape",shapeType:"diamond",name:"Losange Test",x:g.value-100,y:h.value-100,width:60,height:60,rotation:0,opacity:1,visible:!0,locked:!1,zIndex:r.value.length,backgroundColor:"#000000"};r.value.push(e),f.value=e,$(),console.log("Losange noir ajouté pour test:",e)},qe=()=>{const e={id:M(),type:"circle",name:"Cercle Vert",x:50,y:50,width:100,height:100,rotation:0,opacity:1,visible:!0,locked:!1,zIndex:r.value.length,backgroundColor:"#10b981"};r.value.push(e);const t={id:M(),type:"rectangle",name:"Rectangle Violet",x:600,y:80,width:150,height:80,rotation:0,opacity:1,visible:!0,locked:!1,zIndex:r.value.length,backgroundColor:"#8b5cf6"};r.value.push(t);const a={id:M(),type:"shape",shapeType:"diamond",name:"Losange Noir",x:g.value-80,y:h.value-80,width:50,height:50,rotation:0,opacity:1,visible:!0,locked:!1,zIndex:r.value.length,backgroundColor:"#000000"};r.value.push(a);const i={id:M(),type:"text",name:"Texte Test",x:300,y:400,width:200,height:50,rotation:0,opacity:1,visible:!0,locked:!1,zIndex:r.value.length,text:"qsdasdasdasd",fontSize:24,color:"#333333",fontFamily:"Cairo, sans-serif"};r.value.push(i),$(),console.log("Éléments de test ajoutés:",r.value.length)},Je=()=>{console.log("🔍 ===== DIAGNOSTIC COMPLET DÉMARRÉ ====="),console.log("📊 ÉTAT GÉNÉRAL:"),console.log("- Nombre d'éléments:",r.value.length),console.log("- Canvas dimensions:",`${g.value}x${h.value}`),console.log("- Zoom actuel:",x.value),console.log("- Onglet actif:",P.value),console.log("- Preset sélectionné:",E.value),console.log("- Format d'export:",I.value),console.log("📋 DÉTAIL DES ÉLÉMENTS:"),r.value.forEach((e,t)=>{console.log(`  ${t+1}. ${e.type} (${e.name||"Sans nom"})`),console.log(`     - ID: ${e.id}`),console.log(`     - Position: x=${e.x}, y=${e.y}`),console.log(`     - Taille: ${e.width}x${e.height}`),console.log(`     - Visible: ${e.visible}`),console.log("     - Propriétés spéciales:",e.shapeType||e.iconClass||e.text||"Aucune"),console.log("     - Objet complet:",e)}),console.log("🧩 VÉRIFICATION DES COMPOSANTS:"),console.log("- ElementsPanel importé:",!!ke),console.log("- Référence designCanvas:",!!H.value),console.log("- Référence canvasContainer:",!!de.value),console.log("📦 SECTIONS DISPONIBLES:"),console.log("- Onglet elements actif:",P.value==="elements"),console.log("⚙️ FONCTIONS D'EXPORT:"),console.log("- createExportCanvas disponible:",typeof ae=="function"),console.log("- createPreviewCanvas disponible:",typeof q=="function"),console.log("- generatePreviewHTML disponible:",typeof oe=="function"),console.log("🔍 ===== DIAGNOSTIC TERMINÉ ====="),alert(`Diagnostic terminé!

Éléments: ${r.value.length}
Canvas: ${g.value}x${h.value}
Onglet: ${P.value}

Voir la console pour les détails complets.`)},Ye=async()=>{console.log("🐛 ===== DEBUG EXPORT DÉMARRÉ =====");try{console.log("📋 AVANT EXPORT:"),console.log("- Éléments à exporter:",r.value.length),console.log("- Watermark visible:",C.value),console.log("- Preset actuel:",E.value);const e=C.value,t=E.value;C.value=!0,E.value="current",console.log("⚙️ PENDANT EXPORT:"),console.log("- Watermark forcé à:",C.value),console.log("- Preset forcé à:",E.value),await ne(),console.log("🎨 TEST MÉTHODE 1 - createExportCanvas:");const a=await ae();console.log("- Canvas créé:",a.width+"x"+a.height),console.log("- Data URL length:",a.toDataURL().length),console.log("🎨 TEST MÉTHODE 2 - createPreviewCanvas:");const i=await q();console.log("- Canvas créé:",i.width+"x"+i.height),console.log("- Data URL length:",i.toDataURL().length),console.log("⚖️ COMPARAISON:"),console.log("- Même taille:",a.width===i.width&&a.height===i.height),console.log("- Même contenu:",a.toDataURL()===i.toDataURL()),Y(a,"debug-methode1"),setTimeout(()=>Y(i,"debug-methode2"),1e3),C.value=e,E.value=t,console.log("✅ DEBUG EXPORT TERMINÉ"),alert(`Debug export terminé!

Deux fichiers téléchargés:
- debug-methode1.png
- debug-methode2.png

Voir la console pour les détails.`)}catch(e){console.error("❌ ERREUR PENDANT DEBUG EXPORT:",e),alert("Erreur pendant le debug: "+e.message)}},Qe=async()=>{console.log("⚖️ ===== COMPARAISON PRÉVISUALISATION/EXPORT =====");try{console.log("📄 GÉNÉRATION PRÉVISUALISATION HTML:");const e={elements:r.value,canvas:{width:g.value,height:h.value}},t=oe(e);console.log("- HTML généré, longueur:",t.length),console.log("- Éléments dans preview:",e.elements.length),console.log("🎨 GÉNÉRATION CANVAS EXPORT:");const a=await q();console.log("- Canvas créé:",a.width+"x"+a.height),console.log("🪟 OUVERTURE PRÉVISUALISATION:"),window.open("","_blank","width=1000,height=800").document.write(t),console.log("💾 TÉLÉCHARGEMENT EXPORT:"),Y(a,"comparaison-export"),console.log("✅ COMPARAISON PRÊTE"),alert(`Comparaison prête!

1. Fenêtre de prévisualisation ouverte
2. Fichier export téléchargé

Comparez visuellement les deux!`)}catch(e){console.error("❌ ERREUR PENDANT COMPARAISON:",e),alert("Erreur pendant la comparaison: "+e.message)}};function Ze(e){k.value=e}function et(e){const t={id:Date.now(),type:"image",src:e,x:g.value/2-100,y:h.value/2-100,width:200,height:200,name:"صورة"};r.value.push(t),f.value=t}const tt=async()=>{if(console.log("🚀 ===== EXPORT DESIGN AVEC FORMAT DÉMARRÉ ====="),console.log("📋 État avant export:"),console.log("- isExporting:",z.value),console.log("- Format sélectionné:",I.value),console.log("- Preset sélectionné:",E.value),console.log("- Nombre d'éléments:",r.value.length),console.log("- Watermark visible:",C.value),console.log("- Canvas dimensions:",`${g.value}x${h.value}`),z.value){console.log("⚠️ Export déjà en cours, abandon");return}z.value=!0;try{const e=C.value;switch(C.value=!0,console.log("✅ Watermark forcé à true (était:",e,")"),await ne(),console.log("✅ DOM mis à jour"),console.log(`🎯 Lancement export format: ${I.value}`),I.value){case"png":console.log("📸 Appel exportAsPNG()"),await ot();break;case"jpeg":console.log("📸 Appel exportAsJPEG()"),await at();break;case"svg":console.log("🎨 Appel exportAsSVG()"),await nt();break;case"pdf":console.log("📄 Appel exportAsPDF()"),await it();break}C.value=e,G.value=!1,console.log("✅ Watermark restauré et modal fermée"),console.log("🎉 ===== EXPORT TERMINÉ AVEC SUCCÈS =====")}catch(e){console.error("❌ ===== ERREUR PENDANT EXPORT ====="),console.error("Détails de l'erreur:",e),console.error("Stack trace:",e.stack),alert("خطأ في تصدير التصميم: "+e.message)}finally{z.value=!1,console.log("🔄 isExporting remis à false")}},ot=async()=>{await ye()},at=async()=>{await ye()},ye=async()=>{console.log("🎨 ===== EXPORT WATERMARK SIMPLE DÉMARRÉ =====");try{const e=C.value;C.value=!0,console.log("✅ Watermark forcé à true dans exportDesignWithWatermarkSimple"),console.log(`📊 Export avec ${r.value.length} éléments, dimensions: ${g.value}x${h.value}`),console.log("📋 Liste des éléments à exporter:"),r.value.forEach((a,i)=>{console.log(`  ${i+1}. ${a.type} (${a.name}) - visible: ${a.visible} - pos: ${a.x},${a.y} - taille: ${a.width}x${a.height}`)}),await ne(),console.log("✅ DOM mis à jour dans exportDesignWithWatermarkSimple"),console.log("🎨 Appel createPreviewCanvas()");const t=await q();console.log("✅ Canvas créé:",t.width+"x"+t.height),console.log("💾 Appel downloadCanvas()"),Y(t),C.value=e,console.log("✅ Watermark restauré à:",e),console.log("🎉 ===== EXPORT WATERMARK SIMPLE TERMINÉ =====")}catch(e){console.error("❌ ===== ERREUR DANS EXPORT WATERMARK SIMPLE ====="),console.error("Détails de l'erreur:",e),console.error("Stack trace:",e.stack),alert("خطأ في تصدير التصميم: "+e.message)}},q=async()=>{console.log("🎨 ===== CREATE PREVIEW CANVAS DÉMARRÉ =====");const e=document.createElement("canvas"),t=e.getContext("2d");e.width=g.value,e.height=h.value,console.log(`📐 Canvas créé avec dimensions: ${e.width}x${e.height}`),t.fillStyle="#ffffff",t.fillRect(0,0,g.value,h.value),console.log("✅ Fond blanc appliqué"),k.value?(console.log("🖼️ Image de fond détectée:",k.value.substring(0,50)+"..."),await new Promise(a=>{const i=new Image;i.crossOrigin="anonymous",i.onload=()=>{t.drawImage(i,0,0,g.value,h.value),console.log("✅ Image de fond dessinée"),a()},i.onerror=o=>{console.log("❌ Erreur chargement image de fond:",o),a()},i.src=k.value})):console.log("ℹ️ Pas d'image de fond"),console.log(`🎯 Début dessin de ${r.value.length} éléments sur le canvas d'export`);for(let a=0;a<r.value.length;a++){const i=r.value[a];if(console.log(`
--- Élément ${a+1}/${r.value.length} ---`),console.log("Type:",i.type),console.log("Nom:",i.name),console.log("Visible:",i.visible),console.log("Position:",`x=${i.x}, y=${i.y}`),console.log("Taille:",`${i.width}x${i.height}`),console.log("Propriétés spéciales:",i.shapeType||i.iconClass||i.text||"Aucune"),i.visible===!1){console.log("⏭️ Élément ignoré car non visible");continue}console.log("🎨 Dessin de l'élément...");try{await lt(t,i),console.log("✅ Élément dessiné avec succès")}catch(o){console.error("❌ Erreur lors du dessin de l'élément:",o)}}console.log("🔒 Application du watermark...");try{be(t,g.value,h.value),console.log("✅ Watermark appliqué")}catch(a){console.error("❌ Erreur watermark:",a)}return console.log(`🎉 Canvas d'export créé avec succès: ${g.value}x${h.value}`),console.log("🎨 ===== CREATE PREVIEW CANVAS TERMINÉ ====="),e},lt=async(e,t)=>{console.log(`  🎨 drawElementOnCanvas - Type: ${t.type}`),e.save();const a=t.opacity!==void 0?t.opacity:1,i=t.x+(t.width||0)/2,o=t.y+(t.height||0)/2,l=(t.rotation||0)*Math.PI/180;switch(console.log(`  📐 Transformations - Opacity: ${a}, Center: ${i},${o}, Rotation: ${t.rotation||0}°`),e.globalAlpha=a,e.translate(i,o),e.rotate(l),console.log(`  🎯 Switch sur type: ${t.type}`),t.type){case"text":console.log(`    📝 Dessin texte: "${t.text}" - Taille: ${t.fontSize}px - Couleur: ${t.color}`),e.font=`${t.fontWeight||"normal"} ${t.fontSize||16}px ${t.fontFamily||"Cairo, sans-serif"}`,e.fillStyle=t.color||"#000",e.textAlign="center",e.textBaseline="middle",e.fillText(t.text||"نص",0,0),console.log("    ✅ Texte dessiné");break;case"image":console.log(`    🖼️ Dessin image: ${t.src?t.src.substring(0,50)+"...":"Pas de src"}`),await new Promise(c=>{const d=new Image;d.crossOrigin="anonymous",d.onload=()=>{e.drawImage(d,-(t.width||0)/2,-(t.height||0)/2,t.width||100,t.height||100),console.log("    ✅ Image dessinée"),c()},d.onerror=u=>{console.log("    ❌ Erreur chargement image:",u),c()},d.src=t.src});break;case"rectangle":console.log(`    ⬛ Dessin rectangle - Couleur: ${t.backgroundColor} - Taille: ${t.width}x${t.height}`),e.fillStyle=t.backgroundColor||"#000",e.fillRect(-(t.width||0)/2,-(t.height||0)/2,t.width||100,t.height||100),console.log("    ✅ Rectangle dessiné");break;case"circle":console.log(`    ⭕ Dessin cercle - Couleur: ${t.backgroundColor} - Rayon: ${Math.min(t.width||100,t.height||100)/2}`),e.fillStyle=t.backgroundColor||"#10b981",e.beginPath(),e.arc(0,0,Math.min(t.width||100,t.height||100)/2,0,2*Math.PI),e.fill(),console.log("    ✅ Cercle dessiné");break;case"shape":switch(console.log(`    🔷 Dessin forme - Type: ${t.shapeType} - Couleur: ${t.backgroundColor} - Taille: ${t.width}x${t.height}`),e.fillStyle=t.backgroundColor||"#8b5cf6",console.log(`    🎨 Couleur appliquée: ${e.fillStyle}`),t.shapeType){case"circle":console.log("    ⭕ Dessin cercle de forme"),e.beginPath(),e.arc(0,0,Math.min(t.width||50,t.height||50)/2,0,2*Math.PI),e.fill(),console.log("    ✅ Cercle de forme dessiné");break;case"triangle":console.log("    🔺 Dessin triangle"),e.beginPath(),e.moveTo(0,-(t.height||50)/2),e.lineTo(-(t.width||50)/2,(t.height||50)/2),e.lineTo((t.width||50)/2,(t.height||50)/2),e.closePath(),e.fill(),console.log("    ✅ Triangle dessiné");break;case"diamond":console.log("    ◆ DESSIN LOSANGE - CRITIQUE!"),e.beginPath();const c=(t.width||50)/2,d=(t.height||50)/2;console.log(`    📐 Dimensions losange: w=${c}, h=${d}`),e.moveTo(0,-d),console.log(`    📍 Point haut: 0, ${-d}`),e.lineTo(c,0),console.log(`    📍 Point droite: ${c}, 0`),e.lineTo(0,d),console.log(`    📍 Point bas: 0, ${d}`),e.lineTo(-c,0),console.log(`    📍 Point gauche: ${-c}, 0`),e.closePath(),e.fill(),console.log("    ✅ LOSANGE DESSINÉ AVEC SUCCÈS!");break;case"star":console.log("    ⭐ Dessin étoile"),fe(e,0,0,5,(t.width||50)/2,(t.width||50)/4),e.fill(),console.log("    ✅ Étoile dessinée");break;default:console.log(`    ⬛ Dessin rectangle par défaut pour forme inconnue: ${t.shapeType}`),e.fillRect(-(t.width||50)/2,-(t.height||50)/2,t.width||50,t.height||50),console.log("    ✅ Rectangle par défaut dessiné")}console.log(`    ✅ Forme ${t.shapeType} terminée`);break;case"icon":e.fillStyle=t.color||"#374151",e.beginPath(),e.arc(0,0,Math.min(t.width||50,t.height||50)/2,0,2*Math.PI),e.fill(),e.fillStyle="#ffffff",e.font=`${t.fontSize||24}px Arial`,e.textAlign="center",e.textBaseline="middle",e.fillText(J(t.iconClass),0,0);break}e.restore()},J=e=>({"fas fa-home":"🏠","fas fa-user":"👤","fas fa-envelope":"✉","fas fa-phone":"📞","fas fa-calendar":"📅","fas fa-clock":"🕐","fas fa-location-dot":"📍","fas fa-camera":"📷","fas fa-music":"🎵","fas fa-video":"🎥","fas fa-gift":"🎁","fas fa-shopping-cart":"🛒","fas fa-car":"🚗","fas fa-plane":"✈","fas fa-graduation-cap":"🎓","fas fa-trophy":"🏆","fas fa-star":"⭐","fas fa-heart":"❤","fas fa-diamond":"◆"})[e]||"●",st=(e,t)=>{const a=e.backgroundColor||"#8b5cf6",i=e.width||50,o=e.height||50;switch(e.shapeType){case"circle":return`<div class="element" style="${t} background-color: ${a}; border-radius: 50%;"></div>`;case"triangle":return`<div class="element" style="${t} width: 0; height: 0;
                border-left: ${i/2}px solid transparent;
                border-right: ${i/2}px solid transparent;
                border-bottom: ${o}px solid ${a};
                transform: translate(-50%, -50%) rotate(${e.rotation||0}deg);
                left: ${e.x+i/2}px;
                top: ${e.y+o/2}px;"></div>`;case"diamond":return`<div class="element" style="${t} background-color: ${a};
                transform: translate(-50%, -50%) rotate(45deg) rotate(${e.rotation||0}deg);
                left: ${e.x+i/2}px;
                top: ${e.y+o/2}px;"></div>`;case"star":return`<div class="element" style="${t} display: flex; align-items: center; justify-content: center; color: ${a}; font-size: ${i*.8}px;">
                ⭐
            </div>`;default:return`<div class="element" style="${t} background-color: ${a};"></div>`}},be=(e,t,a)=>{e.save();const i=Math.min(t,a)*.08;e.font=`bold ${i}px Cairo, sans-serif`,e.fillStyle="rgba(0, 0, 0, 0.08)",e.textAlign="center";const o=t/2,l=a/2;e.translate(o,l),e.rotate(-45*Math.PI/180),e.fillText("منصة سامقة للتصميم",0,0),e.restore()},Y=(e,t=null)=>{const a=document.createElement("a");a.download=t?`${t}-${Date.now()}.png`:`design-${Date.now()}.png`,a.href=e.toDataURL(),console.log(`💾 TÉLÉCHARGEMENT: ${a.download}`),console.log(`📐 Dimensions: ${e.width}x${e.height}`),console.log(`📊 Data URL length: ${a.href.length} caractères`),console.log("🎨 Premier pixel (debug):",e.getContext("2d").getImageData(0,0,1,1).data),a.click()},nt=async()=>{const e=K.find(n=>n.value===E.value);let t=g.value,a=h.value,i=1;e&&e.width&&e.height&&(t=e.width,a=e.height,i=Math.min(t/g.value,a/h.value));const o=(t-g.value*i)/2,l=(a-h.value*i)/2;let c=`<svg width="${t}" height="${a}" xmlns="http://www.w3.org/2000/svg">`;c+='<rect width="100%" height="100%" fill="white"/>',c+=`<g transform="translate(${o}, ${l}) scale(${i})">`,k.value&&(c+=`<image href="${k.value}" width="${g.value}" height="${h.value}"/>`);for(const n of r.value){if(n.visible===!1)continue;const b=`translate(${n.x+(n.width||0)/2}, ${n.y+(n.height||0)/2}) rotate(${n.rotation||0})`;switch(n.type){case"text":c+=`<text x="0" y="0" transform="${b}"
                    font-family="${n.fontFamily||"Cairo, sans-serif"}"
                    font-size="${n.fontSize||16}"
                    font-weight="${n.fontWeight||"normal"}"
                    fill="${n.color||"#000"}"
                    text-anchor="middle"
                    opacity="${n.opacity!==void 0?n.opacity:1}">
                    ${n.text||""}
                </text>`;break;case"rectangle":c+=`<rect x="${-(n.width||0)/2}" y="${-(n.height||0)/2}"
                    width="${n.width||100}" height="${n.height||100}"
                    fill="${n.backgroundColor||"#000"}"
                    transform="${b}"
                    opacity="${n.opacity!==void 0?n.opacity:1}"/>`;break;case"circle":c+=`<circle cx="0" cy="0"
                    r="${Math.min(n.width||100,n.height||100)/2}"
                    fill="${n.backgroundColor||"#10b981"}"
                    transform="${b}"
                    opacity="${n.opacity!==void 0?n.opacity:1}"/>`;break;case"shape":switch(n.shapeType){case"circle":c+=`<circle cx="0" cy="0"
                            r="${Math.min(n.width||50,n.height||50)/2}"
                            fill="${n.backgroundColor||"#8b5cf6"}"
                            transform="${b}"
                            opacity="${n.opacity!==void 0?n.opacity:1}"/>`;break;case"triangle":const S=n.width||50,le=n.height||50;c+=`<polygon points="0,${-le/2} ${-S/2},${le/2} ${S/2},${le/2}"
                            fill="${n.backgroundColor||"#8b5cf6"}"
                            transform="${b}"
                            opacity="${n.opacity!==void 0?n.opacity:1}"/>`;break;case"star":const vt=Ve(0,0,5,(n.width||50)/2,(n.width||50)/4);c+=`<polygon points="${vt}"
                            fill="${n.backgroundColor||"#8b5cf6"}"
                            transform="${b}"
                            opacity="${n.opacity!==void 0?n.opacity:1}"/>`;break;default:c+=`<rect x="${-(n.width||50)/2}" y="${-(n.height||50)/2}"
                            width="${n.width||50}" height="${n.height||50}"
                            fill="${n.backgroundColor||"#8b5cf6"}"
                            transform="${b}"
                            opacity="${n.opacity!==void 0?n.opacity:1}"/>`}break;case"icon":c+=`<circle cx="0" cy="0"
                    r="${Math.min(n.width||50,n.height||50)/2}"
                    fill="${n.color||"#374151"}"
                    transform="${b}"
                    opacity="${n.opacity!==void 0?n.opacity:1}"/>
                <text x="0" y="0" text-anchor="middle" dominant-baseline="central"
                    font-size="${n.fontSize||24}" fill="white"
                    transform="${b}"
                    opacity="${n.opacity!==void 0?n.opacity:1}">
                    ${J(n.iconClass)}
                </text>`;break;case"image":c+=`<image href="${n.src}"
                    x="${-(n.width||0)/2}" y="${-(n.height||0)/2}"
                    width="${n.width||100}" height="${n.height||100}"
                    transform="${b}"
                    opacity="${n.opacity!==void 0?n.opacity:1}"/>`;break}}c+="</g>";const d=Math.min(t,a)*.08;c+=`<text x="${t/2}" y="${a/2}"
        font-family="Cairo, sans-serif" font-size="${d}" font-weight="bold"
        fill="rgba(0, 0, 0, 0.08)" text-anchor="middle"
        transform="rotate(-45 ${t/2} ${a/2})">منصة سامقة للتصميم</text>`,c+="</svg>";const u=new Blob([c],{type:"image/svg+xml"}),p=document.createElement("a");p.download=`design-${Date.now()}.svg`,p.href=URL.createObjectURL(u),p.click(),URL.revokeObjectURL(p.href)},ae=async()=>{const e=K.find(l=>l.value===E.value);let t=g.value,a=h.value;e&&e.width&&e.height&&e.value!=="current"&&console.log(`Export avec preset ${e.value}: ${e.width}x${e.height}, mais on garde les dimensions originales pour éviter les problèmes de scaling`);const i=document.createElement("canvas"),o=i.getContext("2d");i.width=t,i.height=a,o.fillStyle="#ffffff",o.fillRect(0,0,t,a),k.value&&await new Promise(l=>{const c=new Image;c.crossOrigin="anonymous",c.onload=()=>{if(O.value==="contain"){const d=g.value/h.value,u=c.width/c.height;let p,n,b,S;u>d?(p=g.value,n=g.value/u,b=0,S=(h.value-n)/2):(p=h.value*u,n=h.value,b=(g.value-p)/2,S=0),o.drawImage(c,b,S,p,n)}else if(O.value==="cover"){const d=g.value/h.value,u=c.width/c.height;let p,n,b,S;u>d?(n=h.value,p=h.value*u,b=(g.value-p)/2,S=0):(p=g.value,n=g.value/u,b=0,S=(h.value-n)/2),o.drawImage(c,b,S,p,n)}else o.drawImage(c,0,0,g.value,h.value);l()},c.onerror=()=>l(),c.src=k.value}),console.log(`Dessin de ${r.value.length} éléments sur le canvas d'export`);for(const l of r.value){if(l.visible===!1){console.log(`Élément ${l.id} ignoré car non visible`);continue}switch(console.log(`Dessin de l'élément ${l.id} de type ${l.type}`,l),l.type){case"text":o.save(),o.font=`${l.fontWeight||"normal"} ${l.fontSize||16}px ${l.fontFamily||"Cairo, sans-serif"}`,o.fillStyle=l.color||"#000",o.textAlign=l.textAlign||"left",o.globalAlpha=l.opacity!==void 0?l.opacity:1,o.translate(l.x+(l.width||0)/2,l.y+(l.height||0)/2),o.rotate((l.rotation||0)*Math.PI/180),o.fillText(l.text||"",0,0),o.restore();break;case"image":await new Promise(c=>{const d=new Image;d.crossOrigin="anonymous",d.onload=()=>{o.save(),o.globalAlpha=l.opacity!==void 0?l.opacity:1,o.translate(l.x+(l.width||0)/2,l.y+(l.height||0)/2),o.rotate((l.rotation||0)*Math.PI/180),o.drawImage(d,-(l.width||0)/2,-(l.height||0)/2,l.width||100,l.height||100),o.restore(),c()},d.onerror=()=>c(),d.src=l.src});break;case"rectangle":o.save(),o.globalAlpha=l.opacity!==void 0?l.opacity:1,o.fillStyle=l.backgroundColor||"#000",o.translate(l.x+(l.width||0)/2,l.y+(l.height||0)/2),o.rotate((l.rotation||0)*Math.PI/180),o.fillRect(-(l.width||0)/2,-(l.height||0)/2,l.width||100,l.height||100),o.restore();break;case"circle":o.save(),o.globalAlpha=l.opacity!==void 0?l.opacity:1,o.fillStyle=l.backgroundColor||"#10b981",o.translate(l.x+(l.width||0)/2,l.y+(l.height||0)/2),o.rotate((l.rotation||0)*Math.PI/180),o.beginPath(),o.arc(0,0,Math.min(l.width||100,l.height||100)/2,0,2*Math.PI),o.fill(),o.restore();break;case"shape":switch(o.save(),o.globalAlpha=l.opacity!==void 0?l.opacity:1,o.fillStyle=l.backgroundColor||"#8b5cf6",o.translate(l.x+(l.width||0)/2,l.y+(l.height||0)/2),o.rotate((l.rotation||0)*Math.PI/180),l.shapeType){case"circle":o.beginPath(),o.arc(0,0,Math.min(l.width||50,l.height||50)/2,0,2*Math.PI),o.fill();break;case"triangle":o.beginPath(),o.moveTo(0,-(l.height||50)/2),o.lineTo(-(l.width||50)/2,(l.height||50)/2),o.lineTo((l.width||50)/2,(l.height||50)/2),o.closePath(),o.fill();break;case"star":fe(o,0,0,5,(l.width||50)/2,(l.width||50)/4),o.fill();break;case"diamond":o.beginPath();const c=(l.width||50)/2,d=(l.height||50)/2;o.moveTo(0,-d),o.lineTo(c,0),o.lineTo(0,d),o.lineTo(-c,0),o.closePath(),o.fill();break;default:o.fillRect(-(l.width||50)/2,-(l.height||50)/2,l.width||50,l.height||50)}o.restore();break;case"icon":o.save(),o.globalAlpha=l.opacity!==void 0?l.opacity:1,o.fillStyle=l.color||"#374151",o.translate(l.x+(l.width||0)/2,l.y+(l.height||0)/2),o.rotate((l.rotation||0)*Math.PI/180),o.beginPath(),o.arc(0,0,Math.min(l.width||50,l.height||50)/2,0,2*Math.PI),o.fill(),o.fillStyle="#ffffff",o.font=`${l.fontSize||24}px Arial`,o.textAlign="center",o.textBaseline="middle",o.fillText(J(l.iconClass),0,0),o.restore();break}}return be(o,t,a),console.log(`Canvas d'export créé avec succès: ${t}x${a}`),i},it=async()=>{const t=(await ae()).toDataURL("image/png"),a=window.open("","_blank");a.document.write("<!DOCTYPE html>"),a.document.write("<html>"),a.document.write("<head>"),a.document.write("<title>تصميم سامقة</title>"),a.document.write("<style>"),a.document.write("body { margin: 0; padding: 20px; text-align: center; }"),a.document.write("img { max-width: 100%; height: auto; }"),a.document.write("@media print { body { margin: 0; padding: 0; } }"),a.document.write("</style>"),a.document.write("</head>"),a.document.write("<body>"),a.document.write(`<img src="${t}" alt="Design" />`),a.document.write("<script>"),a.document.write("window.onload = function() {"),a.document.write("window.print();"),a.document.write("setTimeout(function() { window.close(); }, 1000);"),a.document.write("}"),a.document.write("<\/script>"),a.document.write("</body>"),a.document.write("</html>"),a.document.close()};ft(()=>{Xe(),document.addEventListener("keydown",e=>{if(e.ctrlKey||e.metaKey)switch(e.key){case"z":e.preventDefault(),e.shiftKey?te():pe();break;case"y":e.preventDefault(),te();break;case"s":e.preventDefault(),ve();break}e.key==="Delete"&&f.value&&ee(f.value.id)})});function Q(){r.value.forEach((e,t)=>{e.zIndex=t})}function rt(e){if(!f.value)return;const t=r.value.findIndex(a=>a.id===f.value.id);if(t!==-1){if(e==="front"&&t<r.value.length-1){const a=r.value[t];r.value.splice(t,1),r.value.splice(t+1,0,a),Q(),$()}else if(e==="back"&&t>0){const a=r.value[t];r.value.splice(t,1),r.value.splice(t-1,0,a),Q(),$()}}}function ct(){if(!f.value)return;const e={...f.value,id:M()};r.value.push(e),Q(),f.value=e,$()}function dt(){f.value&&(N.value=f.value.id,F.value=!0)}function ut(e){N.value=e,F.value=!0}function gt(){N.value&&(ee(N.value),N.value=null,F.value=!1)}function ht(){N.value=null,F.value=!1}function pt(e){if(f.value){const t=r.value.findIndex(a=>a.id===f.value.id);if(t!==-1){const a=r.value[t];Object.keys(e).forEach(i=>{a[i]=e[i],a.properties&&(a.properties[i]=e[i])}),r.value[t]={...a},$()}}}return(e,t)=>{var a,i;return m(),y(U,null,[j(xe(mt),{title:"محرر التصميم المتقدم - إصدار العملاء"},{default:we(()=>t[4]||(t[4]=[s("link",{href:"https://fonts.googleapis.com/css2?family=Cairo:wght@300;400;600;700&display=swap",rel:"stylesheet"},null,-1),s("link",{href:"https://fonts.googleapis.com/css2?family=Amiri:wght@400;700&display=swap",rel:"stylesheet"},null,-1),s("link",{href:"https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;600;700&display=swap",rel:"stylesheet"},null,-1),s("link",{href:"https://fonts.googleapis.com/css2?family=Tajawal:wght@400;700&display=swap",rel:"stylesheet"},null,-1),s("link",{href:"https://fonts.googleapis.com/css2?family=Changa:wght@400;700&display=swap",rel:"stylesheet"},null,-1),s("link",{href:"https://fonts.googleapis.com/css2?family=Cairo+Play:wght@400;700&display=swap",rel:"stylesheet"},null,-1),s("link",{href:"https://fonts.googleapis.com/css2?family=El+Messiri:wght@400;700&display=swap",rel:"stylesheet"},null,-1),s("link",{href:"https://fonts.googleapis.com/css2?family=Reem+Kufi:wght@400;700&display=swap",rel:"stylesheet"},null,-1),s("link",{href:"https://fonts.googleapis.com/css2?family=Lalezar&display=swap",rel:"stylesheet"},null,-1),s("link",{href:"https://fonts.googleapis.com/css2?family=Harmattan:wght@400;700&display=swap",rel:"stylesheet"},null,-1),s("link",{href:"https://fonts.googleapis.com/css2?family=Markazi+Text:wght@400;700&display=swap",rel:"stylesheet"},null,-1),s("link",{href:"https://fonts.googleapis.com/css2?family=Noto+Kufi+Arabic:wght@400;700&display=swap",rel:"stylesheet"},null,-1),s("link",{href:"https://fonts.googleapis.com/css2?family=Amiri+Quran&display=swap",rel:"stylesheet"},null,-1),s("link",{href:"https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css",rel:"stylesheet"},null,-1)])),_:1,__:[4]}),s("div",St,[s("div",Dt,[s("div",It,[s("div",At,[s("div",Mt,[t[6]||(t[6]=s("div",{class:"w-10 h-10 bg-purple-600 rounded-lg flex items-center justify-center"},[s("i",{class:"fas fa-palette text-white"})],-1)),s("div",null,[t[5]||(t[5]=s("h1",{class:"text-xl font-bold text-gray-800"},"محرر التصميم المتقدم",-1)),s("p",Rt,w(ie.template.name),1)])]),s("div",_t,[s("div",Ot,[s("button",{onClick:pe,disabled:!ge.value,class:"p-2 text-gray-600 hover:text-gray-800 rounded disabled:opacity-50",title:"تراجع"},t[7]||(t[7]=[s("i",{class:"fas fa-undo"},null,-1)]),8,Lt),s("button",{onClick:te,disabled:!he.value,class:"p-2 text-gray-600 hover:text-gray-800 rounded disabled:opacity-50",title:"إعادة"},t[8]||(t[8]=[s("i",{class:"fas fa-redo"},null,-1)]),8,Nt)]),s("div",zt,[(m(),y(U,null,B(Se,o=>s("button",{key:o.id,onClick:l=>Ae(o.id),class:_(["p-2 rounded transition-colors",V.value===o.id?"bg-purple-600 text-white":"text-gray-600 hover:text-gray-800"]),title:o.name},[s("i",{class:_(o.icon)},null,2)],10,jt)),64))]),s("button",{onClick:ve,disabled:W.value,class:"bg-green-600 text-white px-6 py-2 rounded-lg hover:bg-green-700 disabled:opacity-50 flex items-center space-x-2 space-x-reverse"},[s("i",{class:_(W.value?"fas fa-spinner fa-spin":"fas fa-save")},null,2),s("span",null,w(W.value?"جاري الحفظ...":"حفظ"),1)],8,Ut),s("button",{onClick:t[0]||(t[0]=o=>G.value=!0),class:"bg-purple-600 text-white px-6 py-2 rounded-lg hover:bg-purple-700 flex items-center space-x-2 space-x-reverse",title:"تصدير التصميم مع العلامة المائية"},t[9]||(t[9]=[s("i",{class:"fas fa-download"},null,-1),s("span",null,"تصدير",-1)])),s("button",{onClick:Fe,class:"bg-blue-600 text-white px-6 py-2 rounded-lg hover:bg-blue-700 flex items-center space-x-2 space-x-reverse"},t[10]||(t[10]=[s("i",{class:"fas fa-eye"},null,-1),s("span",null,"معاينة",-1)])),j(xe(yt),{href:e.route("client.my-designs"),class:"bg-gray-600 text-white px-6 py-2 rounded-lg hover:bg-gray-700 flex items-center space-x-2 space-x-reverse"},{default:we(()=>t[11]||(t[11]=[s("i",{class:"fas fa-arrow-right"},null,-1),s("span",null,"رجوع",-1)])),_:1,__:[11]},8,["href"])])])])]),s("div",Wt,[s("div",Ft,[s("div",Bt,[s("div",Vt,[(m(),y(U,null,B(Pe,o=>s("button",{key:o.id,onClick:l=>P.value=o.id,class:_(["flex-1 py-3 px-4 text-sm font-medium border-b-2 transition-colors",P.value===o.id?"border-purple-600 text-purple-600 bg-purple-50":"border-transparent text-gray-600 hover:text-gray-800 hover:bg-gray-50"])},[s("i",{class:_([o.icon,"ml-2"])},null,2),xt(" "+w(o.name),1)],10,Gt)),64))])]),s("div",Xt,[P.value==="elements"?(m(),y("div",Ht,[j(ke,{onAddElement:_e,onAddBackground:Ze,onAddImage:et})])):T("",!0),P.value==="layers"?(m(),y("div",Kt,[j(kt,{layers:De.value,"selected-layer-id":(a=f.value)==null?void 0:a.id,onSelectLayer:Le,onRequestDeleteLayer:ut,onReorderLayers:ze,onUpdateLayer:e.updateLayer,onDuplicateLayer:e.duplicateLayer,onMoveLayerTop:e.moveLayerToTop,onMoveLayerBottom:e.moveLayerToBottom},null,8,["layers","selected-layer-id","onUpdateLayer","onDuplicateLayer","onMoveLayerTop","onMoveLayerBottom"])])):T("",!0),P.value==="properties"?(m(),y("div",qt,[j(Ct,{"selected-element":f.value,onUpdateProperties:pt,onMoveLayer:rt,onDuplicateElement:ct,onRequestDelete:dt},null,8,["selected-element"])])):T("",!0)])]),s("div",Jt,[s("div",Yt,[s("div",Qt,[s("div",Zt,[s("div",eo,[s("button",{onClick:Re,class:"p-2 text-gray-600 hover:text-gray-800 rounded"},t[12]||(t[12]=[s("i",{class:"fas fa-search-minus"},null,-1)])),s("span",to,w(Math.round(x.value*100))+"%",1),s("button",{onClick:Me,class:"p-2 text-gray-600 hover:text-gray-800 rounded"},t[13]||(t[13]=[s("i",{class:"fas fa-search-plus"},null,-1)]))]),t[14]||(t[14]=s("div",{class:"flex items-center bg-purple-50 text-purple-700 px-3 py-1 rounded-lg text-sm"},[s("i",{class:"fas fa-shield-alt ml-2"}),s("span",null,"علامة مائية محمية")],-1)),s("div",{class:"flex items-center space-x-2 space-x-reverse"},[s("button",{onClick:Je,class:"px-3 py-1 bg-blue-500 text-white rounded text-sm hover:bg-blue-600",title:"Diagnostic complet avec logs"}," 🔍 Diagnostic "),s("button",{onClick:qe,class:"px-3 py-1 bg-green-500 text-white rounded text-sm hover:bg-green-600",title:"Ajouter des éléments de test"}," Test Complet "),s("button",{onClick:Ye,class:"px-3 py-1 bg-orange-500 text-white rounded text-sm hover:bg-orange-600",title:"Export avec debug détaillé"}," 🐛 Debug Export "),s("button",{onClick:Qe,class:"px-3 py-1 bg-purple-500 text-white rounded text-sm hover:bg-purple-600",title:"Comparer prévisualisation et export"}," ⚖️ Comparer ")]),s("button",{onClick:Ke,class:"px-3 py-1 bg-red-500 text-white rounded text-sm hover:bg-red-600",title:"Ajouter un losange noir pour test"}," Test ◆ ")])])]),s("div",oo,[s("div",{ref_key:"canvasContainer",ref:de,class:"relative bg-white shadow-lg",style:se({width:g.value*x.value+"px",height:h.value*x.value+"px",transform:`scale(${x.value})`,transformOrigin:"top left"})},[Ce.value?(m(),y("div",{key:0,class:"absolute inset-0 pointer-events-none",style:se(Ie.value)},null,4)):T("",!0),s("div",{ref_key:"designCanvas",ref:H,class:"w-full h-full relative overflow-hidden",style:se({backgroundImage:k.value?`url(${k.value})`:"none",backgroundSize:O.value,backgroundPosition:"center",backgroundRepeat:"no-repeat",cursor:L.value?"crosshair":"default"}),onClick:je,onDrop:Ue,onDragover:t[1]||(t[1]=$e(()=>{},["prevent"]))},[(m(!0),y(U,null,B(r.value,o=>{var l;return m(),$t(Tt,{key:o.id,element:o,selected:((l=f.value)==null?void 0:l.id)===o.id,zoom:x.value,placementMode:!!L.value,onSelect:Oe,onUpdate:Ne,onDelete:ee},null,8,["element","selected","zoom","placementMode"])}),128)),t[15]||(t[15]=s("div",{class:"absolute pointer-events-none select-none",style:{top:"50%",left:"50%",transform:"translate(-50%, -50%) rotate(-45deg)",fontSize:"48px",color:"rgba(0, 0, 0, 0.08)",fontFamily:"Cairo, sans-serif",fontWeight:"bold",textShadow:"1px 1px 2px rgba(255, 255, 255, 0.5)",zIndex:9999,userSelect:"none",WebkitUserSelect:"none",MozUserSelect:"none",msUserSelect:"none",letterSpacing:"4px",whiteSpace:"nowrap"}}," منصة سامقة للتصميم ",-1))],36)],4)])])]),re.value?(m(),y("div",{key:0,class:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",onClick:$e(me,["self"])},[s("div",ao,[j(Et,{"image-element":ce.value,onSave:He},null,8,["image-element"])])])):T("",!0),Ee.value?(m(),y("div",lo,[s("div",so,[t[16]||(t[16]=s("i",{class:"fas fa-spinner fa-spin text-2xl text-purple-600"},null,-1)),s("span",no,w(Te.value),1)])])):T("",!0),F.value?(m(),y("div",io,[s("div",{class:"bg-white rounded-lg shadow-lg p-8 max-w-sm w-full text-center"},[t[17]||(t[17]=s("h2",{class:"text-lg font-bold mb-4"},"تأكيد الحذف",-1)),t[18]||(t[18]=s("p",{class:"mb-6"},"هل أنت متأكد أنك تريد حذف هذا العنصر؟ لا يمكن التراجع عن هذا الإجراء.",-1)),s("div",{class:"flex justify-center gap-4"},[s("button",{onClick:gt,class:"bg-red-600 text-white px-6 py-2 rounded hover:bg-red-700"},"حذف"),s("button",{onClick:ht,class:"bg-gray-300 text-gray-700 px-6 py-2 rounded hover:bg-gray-400"},"إلغاء")])])])):T("",!0),G.value?(m(),y("div",ro,[s("div",co,[t[23]||(t[23]=s("h2",{class:"text-xl font-bold mb-6 text-center"},"تصدير التصميم",-1)),s("div",uo,[t[19]||(t[19]=s("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"اختر الحجم والجودة:",-1)),s("div",go,[(m(),y(U,null,B(K,o=>s("button",{key:o.value,onClick:l=>E.value=o.value,class:_(["p-3 border-2 rounded-lg text-right transition-all",E.value===o.value?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 hover:border-gray-300"])},[s("div",po,w(o.label),1),s("div",vo,w(o.description),1),o.width&&o.height?(m(),y("div",fo,w(o.width)+" × "+w(o.height)+" ("+w(o.dpi)+" DPI) ",1)):T("",!0)],10,ho)),64))])]),s("div",mo,[t[20]||(t[20]=s("label",{class:"block text-sm font-medium text-gray-700 mb-3"},"اختر صيغة التصدير:",-1)),s("div",yo,[(m(),y(U,null,B(ue,o=>s("button",{key:o.value,onClick:l=>I.value=o.value,class:_(["p-4 border-2 rounded-lg text-center transition-all",I.value===o.value?"border-purple-500 bg-purple-50 text-purple-700":"border-gray-200 hover:border-gray-300"])},[s("i",{class:_([o.icon,"text-2xl mb-2 block"])},null,2),s("div",wo,w(o.label),1),s("div",xo,w(o.description),1)],10,bo)),64))])]),I.value==="jpeg"?(m(),y("div",$o,[t[21]||(t[21]=s("label",{class:"block text-sm font-medium text-gray-700 mb-2"},"جودة الصورة:",-1)),bt(s("input",{"onUpdate:modelValue":t[2]||(t[2]=o=>X.value=o),type:"range",min:"10",max:"100",step:"10",class:"w-full"},null,512),[[wt,X.value]]),s("div",ko,w(X.value)+"%",1)])):T("",!0),s("div",Co,[t[22]||(t[22]=s("h3",{class:"font-medium text-gray-700 mb-2"},"معلومات التصدير:",-1)),s("div",Eo,[s("div",null,"الصيغة: "+w((i=ue.find(o=>o.value===I.value))==null?void 0:i.label),1),s("div",null,"الحجم: "+w(Ge()),1),I.value==="jpeg"?(m(),y("div",To,"الجودة: "+w(X.value)+"%",1)):T("",!0)])]),s("div",Po,[s("button",{onClick:t[3]||(t[3]=o=>G.value=!1),class:"px-6 py-2 border border-gray-300 rounded-lg hover:bg-gray-50"}," إلغاء "),s("button",{onClick:tt,disabled:z.value,class:"px-6 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:opacity-50"},[z.value?(m(),y("span",Do,"جاري التصدير...")):(m(),y("span",Io,"تصدير"))],8,So)])])])):T("",!0)])],64)}}},Oo=Pt(Ao,[["__scopeId","data-v-aa29bb8a"]]);export{Oo as default};
